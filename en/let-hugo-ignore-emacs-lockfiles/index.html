<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.139.3"><title>Let Hugo ignore Emacs lockfiles &#183; Holger Schurig's Computer Calisthenics & Orthodontia</title>
<link rel=stylesheet href=../../css/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=../../css/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=../../css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/side-menu.css><!--<![endif]--><link rel=stylesheet href=../../css/blackburn.css><link rel=stylesheet href=../../css/all.min.css><link rel=alternate type=application/rss+xml title="Holger Schurig's Computer Calisthenics & Orthodontia" href=../../index.xml><link rel="shortcut icon" href=../../img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=../../><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../en/><i class='fa fa-list fa-fw'></i>Articles</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../de/><i class='fa fa-list fa-fw'></i>Beitr√§ge</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../categories/><i class='fa fa-folder fa-fw'></i>Categories</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../impressum/><i class='fa fa-phone fa-fw'></i>Impressum</a></li></ul></div></div><div id=main><div class=header><h1>Let Hugo ignore Emacs lockfiles</h1><h2></h2></div><div class=content><p>When you run</p><pre><code>hugo server
</code></pre><p>the static web-site generator <a href=http://gohugo.io>Hugo</a> creates a local
server that you can use to fine-tune your pages. Hugo sits and watches
your content and layout directory for any changes. Whenever a file changes,
it re-renders the pages and even tells your browser to live-relead the pages.</p><p>Very nice.</p><p>Except that it doesn&rsquo;t work with Emacs. But there&rsquo;s a cure.</p><h2 id=the-problem>The problem</h2><p>The problem is that Emacs creates lockfiles and Hugo triggers detects
those lockfiles, but get&rsquo;s confused. Here is such a lockfile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>schurig@desktop:~/www.hugo/content/en$ ll
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>24</span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> schurig schurig  <span style=color:#ae81ff>988</span> Apr  <span style=color:#ae81ff>1</span> 08:55 bash-aliases.md
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> schurig schurig <span style=color:#ae81ff>1759</span> Apr  <span style=color:#ae81ff>1</span> 08:55 blogging-with-sitecopy.md
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> schurig schurig <span style=color:#ae81ff>4096</span> Apr  <span style=color:#ae81ff>1</span> 08:55 emacs-blog-from-org-to-hugo/
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> schurig schurig <span style=color:#ae81ff>6503</span> Apr  <span style=color:#ae81ff>1</span> 08:55 emacs-blog-from-org-to-hugo.md
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> schurig schurig <span style=color:#ae81ff>3593</span> Apr  <span style=color:#ae81ff>1</span> 08:55 emacs-init-tangle.md
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> schurig schurig   <span style=color:#ae81ff>21</span> Apr  <span style=color:#ae81ff>1</span> 08:58 .#let-hugo-ignore-emacs-lockfiles.md -&gt; schurig@desktop.28219
</span></span></code></pre></div><p>(Note: <code>ll</code> is described in <a href=../../en/bash-aliases/>bash aliases</a>).</p><h2 id=the-cure>The cure</h2><p>Setting <code>ignoreFiles</code> in <code>config.toml</code> won&rsquo;t help. The file system watcher doesn&rsquo;t care
about the <code>ignoreFile</code> setting.</p><p>I finally fixed this with a patch to Hugo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>diff --git a/commands/hugo.go b/commands/hugo.go
</span></span><span style=display:flex><span>index 131879c..1ed9823 100644
</span></span><span style=display:flex><span><span style=color:#f92672>--- a/commands/hugo.go
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/commands/hugo.go
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -732,12 +732,14 @@ func NewWatcher(port int) error {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> 
</span></span><span style=display:flex><span> 				for _, ev := range evs {
</span></span><span style=display:flex><span> 					ext := filepath.Ext(ev.Name)
</span></span><span style=display:flex><span><span style=color:#a6e22e>+					base := filepath.Base(ev.Name)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span> 					istemp := strings.HasSuffix(ext, &#34;~&#34;) ||
</span></span><span style=display:flex><span> 						(ext == &#34;.swp&#34;) ||
</span></span><span style=display:flex><span> 						(ext == &#34;.swx&#34;) ||
</span></span><span style=display:flex><span> 						(ext == &#34;.tmp&#34;) ||
</span></span><span style=display:flex><span> 						(ext == &#34;.DS_Store&#34;) ||
</span></span><span style=display:flex><span> 						filepath.Base(ev.Name) == &#34;4913&#34; ||
</span></span><span style=display:flex><span><span style=color:#a6e22e>+						strings.HasPrefix(base, &#34;.#&#34;) || // Emacs lock files
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span> 						strings.HasPrefix(ext, &#34;.goutputstream&#34;) ||
</span></span><span style=display:flex><span> 						strings.HasSuffix(ext, &#34;jb_old___&#34;) ||
</span></span><span style=display:flex><span> 						strings.HasSuffix(ext, &#34;jb_bak___&#34;)
</span></span></code></pre></div><div class=post-meta><div><i class="fa fa-copyright fa-fw"></i>
License: <a href=https://spdx.org/licenses/CC-BY-SA-4.0.html target=_blank>CC-BY-SA 4.0</a></div><div><i class="fa fa-calendar fa-fw"></i>
<time>2016-04-01</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=../../categories/emacs>Emacs</a>
<a class=rss type=application/rss+xml href=../../categories/emacs/index.xml><span class="fa fa-rss">RSS</span></a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=../../tags/hugo>Hugo</a>
<a class=rss type=application/rss+xml href=../../tags/hugo/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/emacs>Emacs</a>
<a class=rss type=application/rss+xml href=../../tags/emacs/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/blogging>Blogging</a>
<a class=rss type=application/rss+xml href=../../tags/blogging/index.xml><span class="fa fa-rss">RSS</span></a></div></div></div></div></div><script src=../../js/ui.js></script><script src=../../js/menus.js></script><script src=../../js/math-code.js></script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>