<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.108.0"><title>notmuch: automatically mark uninteresting mails as read &#183; Holger Schurig's Computer Calisthenics & Orthodontia</title><link rel=stylesheet href=../../css/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=../../css/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=../../css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/side-menu.css><!--<![endif]--><link rel=stylesheet href=../../css/blackburn.css><link rel=stylesheet href=../../css/all.min.css><link rel="shortcut icon" href=../../img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=../../><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../en/><i class='fa fa-list fa-fw'></i>Articles</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../de/><i class='fa fa-list fa-fw'></i>Beitr√§ge</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../topics/><i class='fa fa-folder fa-fw'></i>Topics</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../impressum/><i class='fa fa-phone fa-fw'></i>Impressum</a></li></ul></div><div><div class=small-print><small></small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div></div></div><div id=main><div class=header><h1>notmuch: automatically mark uninteresting mails as read</h1><h2></h2></div><div class=content><p>Now that I switched from Emacs&rsquo; <code>GNUS</code> to Emacs&rsquo; <code>notmuch</code>, I needed a
method to automatically &ldquo;discard&rdquo; uninteresting mails. In some Linux
mailing lists a huge amount of mails are about topics that I don&rsquo;t
care. So I a little shell script <code>bin/pollmail.sh</code> that polls
the mails and efficiently marks uninteresting stuff as read.</p><h2 id=prepare-notmuch>Prepare notmuch</h2><p>But first, have a look at a snipped from <code>~/.notmuch-config</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>[new]
</span></span><span style=display:flex><span>tags=unread
</span></span></code></pre></div><p>This makes <code>notmuch</code> tak all newly imported mails with the tag &lsquo;+unread&rsquo;.</p><h2 id=how-to-tag-based-on-a-filer>How to tag based on a filer</h2><p>When I filter messages, obviously I only need to filter such mails. So I
could do</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>holger@holger$ notmuch tag -unread -- tag:unread (subject:boring or subject:moreboring)
</span></span></code></pre></div><p>That would even work&mldr; if I hadn&rsquo;t so many subjects that don&rsquo;t
interest me with the type of embedded hardware that I use: ARM64,
Allwinner, Rockchip, KVM, kexec, PCI, PCIe &mldr; &mldr; &mldr; more than
100 topics are of no interest to me.</p><p>Clearly the command line would get too long.</p><h2 id=using-notmuch-tag---batch>Using notmuch tag --batch</h2><p>But wait, there&rsquo;s <code>notmuch tag --batch</code> available, so we can use that.</p><h3 id=prepare-list-of-uninteresting-terms->Prepare list of uninteresting terms &mldr;</h3><p>But first, let&rsquo;s define the topics for the various mailing lists that
I don&rsquo;t care about. This is an expert from what I tend to ignore on
the linux-arm-kernel mailing list:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>read -r -d <span style=color:#e6db74>&#39;\n&#39;</span> UNINTERESTING_LKA &lt;&lt;<span style=color:#e6db74>&#39;EOF&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Subsystems</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>acpi
</span></span><span style=display:flex><span>arm64
</span></span><span style=display:flex><span>dmaengine
</span></span><span style=display:flex><span>kexec
</span></span><span style=display:flex><span>kvm
</span></span><span style=display:flex><span>mdio
</span></span><span style=display:flex><span>mtd
</span></span><span style=display:flex><span>pci*
</span></span><span style=display:flex><span>spi-nor
</span></span><span style=display:flex><span>vdma
</span></span></code></pre></div><p>&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>moxart
</span></span><span style=display:flex><span>tango*
</span></span><span style=display:flex><span>EOF
</span></span></code></pre></div><p>I could have written the assignment of the uninteresting topics to <code>$UNINTERESTING_LKA</code>
also more traditionally:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>UNINTERESTING_LKA<span style=color:#f92672>+=</span><span style=color:#e6db74>&#34;acpi &#34;</span>
</span></span><span style=display:flex><span>UNINTERESTING_LKA<span style=color:#f92672>+=</span><span style=color:#e6db74>&#34;arm64 &#34;</span>
</span></span></code></pre></div><p>But I like the above method more, less typing involved.</p><h3 id=-create-a-query-from-it->&mldr; create a query from it &mldr;</h3><p>The following now creates a query inside a temporary file and asks
notmuch to execute the tag command with it. Because the search
runs only on unread mails, it&rsquo;s actually quite fast. Despite the
fact that I have now around 100 uninteresting terms.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mark_uninteresting_do<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;- marking uninteresting in </span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        local i
</span></span><span style=display:flex><span>        echo -n <span style=color:#e6db74>&#34;-unread -- &#34;</span> &gt;/tmp/notmuch.$$
</span></span><span style=display:flex><span>        echo -n <span style=color:#e6db74>&#34;tag:unread &#34;</span> &gt;&gt;/tmp/notmuch.$$
</span></span><span style=display:flex><span>        echo -n <span style=color:#e6db74>&#34;folder:</span>$1<span style=color:#e6db74> (subject:grumblfutz&#34;</span> &gt;&gt;/tmp/notmuch.$$
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i in $2; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>                test <span style=color:#e6db74>${</span>i:0:1<span style=color:#e6db74>}</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;#&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># echo &#34;i:$i&#34;</span>
</span></span><span style=display:flex><span>                echo -n <span style=color:#e6db74>&#34; OR subject:</span>$i<span style=color:#e6db74>&#34;</span> &gt;&gt; /tmp/notmuch.$$
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;)&#34;</span> &gt;&gt; /tmp/notmuch.$$
</span></span><span style=display:flex><span>        <span style=color:#75715e># cat /tmp/notmuch.$$</span>
</span></span><span style=display:flex><span>        notmuch tag --batch &lt;/tmp/notmuch.$$
</span></span><span style=display:flex><span>        rm -f /tmp/notmuch.$$
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=-and-apply-everything>&mldr; and apply everything</h3><p>The code that runs this is actually simple:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mark_uninteresting<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mark_uninteresting_do linux-arm-kernel <span style=color:#e6db74>&#34;</span>$UNINTERESTING_LKA<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        mark_uninteresting_do linux-mmc        <span style=color:#e6db74>&#34;</span>$UNINTERESTING_MMC<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        mark_uninteresting_do linux-can        <span style=color:#e6db74>&#34;</span>$UNINTERESTING_CAN<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div></div></div><script src=../../js/ui.js></script>
<script src=../../js/menus.js></script>
<script src=../../js/math-code.js></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>