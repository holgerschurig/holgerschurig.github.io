<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.82.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta property="og:title" content="notmuch: automatically mark uninteresting mails as read"><meta name=keywords content="notmuch"><meta property="og:title" content="notmuch: automatically mark uninteresting mails as read"><meta property="og:description" content="Now that I switched from Emacs' GNUS to Emacs' notmuch, I needed a
method to automatically &ldquo;discard&rdquo; uninteresting mails. In some Linux
mailing lists a huge amount of mails are about topics that I don&rsquo;t
care. So I a little shell script bin/pollmail.sh that polls
the mails and efficiently marks uninteresting stuff as read."><meta property="og:type" content="article"><meta property="og:url" content="http://holgerschurig.github.io/en/notmuch-mark-uninteresting/"><meta property="article:section" content="en"><meta property="article:published_time" content="2016-05-02T00:00:00+00:00"><meta property="article:modified_time" content="2016-05-02T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="notmuch: automatically mark uninteresting mails as read"><meta name=twitter:description content="Now that I switched from Emacs' GNUS to Emacs' notmuch, I needed a
method to automatically &ldquo;discard&rdquo; uninteresting mails. In some Linux
mailing lists a huge amount of mails are about topics that I don&rsquo;t
care. So I a little shell script bin/pollmail.sh that polls
the mails and efficiently marks uninteresting stuff as read."><link rel=icon type=image/png href=../../favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=../../css/normalize.css><link rel=stylesheet type=text/css media=screen href=../../css/main.css><link rel=stylesheet type=text/css media=screen href=../../css/all.css><link rel=stylesheet href=../../css/katex.min.css crossorigin=anonymous><script defer src=../../js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=../../js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><title>notmuch: automatically mark uninteresting mails as read | Holger Schurig's Computer Calisthenics & Orthodontia</title></head><body><header><div id=avatar><a href=http://holgerschurig.github.io/><img src=../../img/vitae.jpg alt="Holger Schurig's Computer Calisthenics & Orthodontia"></a></div><div id=titletext><h2 id=title><a href=http://holgerschurig.github.io/>Holger Schurig's Computer Calisthenics & Orthodontia</a></h2></div><div id=title-description><p id=subtitle></p><div id=social><nav><ul><li><a href=../../index.xml><i title=RSS class="icons fas fa-rss"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=../../en>English</a></li><li><a href=../../de>Deutsch</a></li><li><a href=../../tags>Tags</a></li><li><a href=../../topics>Topics</a></li><li><a href=../../impressum>Impressum</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>02</span>
<span class=rest>May 2016</span></div></div><div class=matter><h1 class=title>notmuch: automatically mark uninteresting mails as read</h1></div></div><div class=markdown><p>Now that I switched from Emacs' <code>GNUS</code> to Emacs' <code>notmuch</code>, I needed a
method to automatically &ldquo;discard&rdquo; uninteresting mails. In some Linux
mailing lists a huge amount of mails are about topics that I don&rsquo;t
care. So I a little shell script <code>bin/pollmail.sh</code> that polls
the mails and efficiently marks uninteresting stuff as read.</p><h2 id=prepare-notmuch>Prepare notmuch</h2><p>But first, have a look at a snipped from <code>~/.notmuch-config</code>:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[new]
tags=unread
</code></pre></div><p>This makes <code>notmuch</code> tak all newly imported mails with the tag &lsquo;+unread&rsquo;.</p><h2 id=how-to-tag-based-on-a-filer>How to tag based on a filer</h2><p>When I filter messages, obviously I only need to filter such mails. So I
could do</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>holger@holger$ notmuch tag -unread -- tag:unread (subject:boring or subject:moreboring)
</code></pre></div><p>That would even work&mldr; if I hadn&rsquo;t so many subjects that don&rsquo;t
interest me with the type of embedded hardware that I use: ARM64,
Allwinner, Rockchip, KVM, kexec, PCI, PCIe &mldr; &mldr; &mldr; more than
100 topics are of no interest to me.</p><p>Clearly the command line would get too long.</p><h2 id=using-notmuch-tag---batch>Using notmuch tag --batch</h2><p>But wait, there&rsquo;s <code>notmuch tag --batch</code> available, so we can use that.</p><h3 id=prepare-list-of-uninteresting-terms->Prepare list of uninteresting terms &mldr;</h3><p>But first, let&rsquo;s define the topics for the various mailing lists that
I don&rsquo;t care about. This is an expert from what I tend to ignore on
the linux-arm-kernel mailing list:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#579>#!/bin/bash
</span><span style=color:#579></span>
<span style=color:#007020>read</span> -r -d <span style=background-color:#fff0f0>&#39;\n&#39;</span> UNINTERESTING_LKA &lt;&lt;<span style=background-color:#fff0f0>&#39;EOF&#39;</span>
<span style=color:#888>#</span>
<span style=color:#888>#Subsystems</span>
<span style=color:#888>#</span>
acpi
arm64
dmaengine
kexec
kvm
mdio
mtd
pci*
spi-nor
vdma
</code></pre></div><p>&mldr;</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>moxart
tango*
EOF
</code></pre></div><p>I could have written the assignment of the uninteresting topics to <code>$UNINTERESTING_LKA</code>
also more traditionally:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#963>UNINTERESTING_LKA</span><span style=color:#333>+=</span><span style=background-color:#fff0f0>&#34;acpi &#34;</span>
<span style=color:#963>UNINTERESTING_LKA</span><span style=color:#333>+=</span><span style=background-color:#fff0f0>&#34;arm64 &#34;</span>
</code></pre></div><p>But I like the above method more, less typing involved.</p><h3 id=-create-a-query-from-it->&mldr; create a query from it &mldr;</h3><p>The following now creates a query inside a temporary file and asks
notmuch to execute the tag command with it. Because the search
runs only on unread mails, it&rsquo;s actually quite fast. Despite the
fact that I have now around 100 uninteresting terms.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mark_uninteresting_do<span style=color:#333>()</span>
<span style=color:#333>{</span>
        <span style=color:#007020>echo</span> <span style=background-color:#fff0f0>&#34;- marking uninteresting in </span><span style=color:#963>$1</span><span style=background-color:#fff0f0>&#34;</span>
        <span style=color:#007020>local</span> i
        <span style=color:#007020>echo</span> -n <span style=background-color:#fff0f0>&#34;-unread -- &#34;</span> &gt;/tmp/notmuch.<span style=color:#963>$$</span>
        <span style=color:#007020>echo</span> -n <span style=background-color:#fff0f0>&#34;tag:unread &#34;</span> &gt;&gt;/tmp/notmuch.<span style=color:#963>$$</span>
        <span style=color:#007020>echo</span> -n <span style=background-color:#fff0f0>&#34;folder:</span><span style=color:#963>$1</span><span style=background-color:#fff0f0> (subject:grumblfutz&#34;</span> &gt;&gt;/tmp/notmuch.<span style=color:#963>$$</span>
        <span style=color:#080;font-weight:700>for</span> i in <span style=color:#963>$2</span>; <span style=color:#080;font-weight:700>do</span>
                <span style=color:#007020>test</span> <span style=background-color:#eee>${</span><span style=color:#963>i</span>:<span style=color:#963>0</span>:<span style=color:#963>1</span><span style=background-color:#eee>}</span> <span style=color:#333>==</span> <span style=background-color:#fff0f0>&#34;#&#34;</span> <span style=color:#333>&amp;&amp;</span> <span style=color:#080;font-weight:700>continue</span>
                <span style=color:#888># echo &#34;i:$i&#34;</span>
                <span style=color:#007020>echo</span> -n <span style=background-color:#fff0f0>&#34; OR subject:</span><span style=color:#963>$i</span><span style=background-color:#fff0f0>&#34;</span> &gt;&gt; /tmp/notmuch.<span style=color:#963>$$</span>
        <span style=color:#080;font-weight:700>done</span>
        <span style=color:#007020>echo</span> <span style=background-color:#fff0f0>&#34;)&#34;</span> &gt;&gt; /tmp/notmuch.<span style=color:#963>$$</span>
        <span style=color:#888># cat /tmp/notmuch.$$</span>
        notmuch tag --batch &lt;/tmp/notmuch.<span style=color:#963>$$</span>
        rm -f /tmp/notmuch.<span style=color:#963>$$</span>
<span style=color:#333>}</span>
</code></pre></div><h3 id=-and-apply-everything>&mldr; and apply everything</h3><p>The code that runs this is actually simple:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mark_uninteresting<span style=color:#333>()</span>
<span style=color:#333>{</span>
        mark_uninteresting_do linux-arm-kernel <span style=background-color:#fff0f0>&#34;</span><span style=color:#963>$UNINTERESTING_LKA</span><span style=background-color:#fff0f0>&#34;</span>
        mark_uninteresting_do linux-mmc        <span style=background-color:#fff0f0>&#34;</span><span style=color:#963>$UNINTERESTING_MMC</span><span style=background-color:#fff0f0>&#34;</span>
        mark_uninteresting_do linux-can        <span style=background-color:#fff0f0>&#34;</span><span style=color:#963>$UNINTERESTING_CAN</span><span style=background-color:#fff0f0>&#34;</span>
<span style=color:#333>}</span>
</code></pre></div></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=../../tags/notmuch/>notmuch</a></p></div><div class=clearit></div><div class=tags><div class=taxosfloating_left><p>Topics</p></div><div class=termsfloating_right><p><a href=../../topics/linux/>linux</a></p></div><div class=clearit></div></div></div></main></body></html>