<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.123.7"><title>MNCI: Handterminal mit ARM (Intel PXA320) &#183; Holger Schurig's Computer Calisthenics & Orthodontia</title>
<link rel=stylesheet href=../../css/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=../../css/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=../../css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/side-menu.css><!--<![endif]--><link rel=stylesheet href=../../css/blackburn.css><link rel=stylesheet href=../../css/all.min.css><link rel=alternate type=application/rss+xml title="Holger Schurig's Computer Calisthenics & Orthodontia" href=../../index.xml><link rel="shortcut icon" href=../../img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=../../><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../en/><i class='fa fa-list fa-fw'></i>Articles</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../de/><i class='fa fa-list fa-fw'></i>Beiträge</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../categories/><i class='fa fa-folder fa-fw'></i>Categories</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../impressum/><i class='fa fa-phone fa-fw'></i>Impressum</a></li></ul></div></div><div id=main><div class=header><h1>MNCI: Handterminal mit ARM (Intel PXA320)</h1><h2></h2></div><div class=content><p>Hier stelle ich ein komplexes Projekt vor, bei dem ich federführend die gesamte<br>Software erstellt habe.<br></p><div class="ox-hugo-toc toc"><div class=heading>Table of Contents</div><ul><li><a href=#projekt-info>Projekt-Info</a></li><li><a href=#vorgeschichte>Vorgeschichte</a></li><li><a href=#zum-ger%C3%A4t>Zum Gerät</a></li><li><a href=#bootloader>Bootloader</a></li><li><a href=#flashen-via-boundary-scan>Flashen via Boundary-Scan</a></li><li><a href=#linux-kernel>Linux-Kernel</a></li><li><a href=#user-space>User-Space</a></li><li><a href=#projektende>Projektende</a></li><li><a href=#verwandte-projekte>Verwandte Projekte</a></li></ul></div><div class=job><p>In Beiträgen der Kategorie <a href=../../categories/job/>Job</a> trage ich Projekte zusammen, die ich im Rahmen<br>meiner beruflichen Karriere federführend durchgeführt habe. Ich gehe dabei mit<br>Absicht nicht allzu sehr auf Details an: die Interessen meiner Arbeitgeber sollen<br>ja nicht berührt werden.<br></p></div><h2 id=projekt-info>Projekt-Info</h2><p>Idee: Frau Wienkötter, eine großer Süddeutscher Spediteur<br></p><p>Umsetzung: im Prinzip mit ein Kernteam von nur 3 Leuten:<br></p><ul><li>Klaus, ein externer Elektronikentwickler<br></li><li>Wolfgang, machte die gesamte Mechanik (Gehäuse, Tastatur, Finishing) und Produktionsplanung<br></li><li>Ich, für die gesamte Software (Bootloader, Kernel, Filesystem, Terminal-Applikation Telnet und 5250)<br></li></ul><p>Implementierung: C, C++, Qt/Embedded, OpenEmbedded<br></p><h2 id=vorgeschichte>Vorgeschichte</h2><p>Ich arbeitete damals bei &ldquo;M&amp;N Solutions GmbH&rdquo; in Rosbach. Diese Firma hat Geräte<br>für die Logistik eingekauft (z.B. bei Intermec) und weiterverkauft. Dadurch<br>hatte sie schon eine Menge an Kontakte in die Logistikwelt, zu Speditionen und<br>auch Einzelhändlern.<br></p><p>Einer unserer Kunden suchte nun ein Handterminal für seine LKW-Fahrer. Damals<br>fand er im Markt noch nichts, was auf seine Anforderungen passte:<br></p><ul><li>eingebauter Barcode-Scanner<br></li><li>eingebautes GSM-Modem<br></li><li>eingebautes WLAN<br></li><li>eingebaute Kamera (um bei Schäden Dokumentations-Fotos machen zu können)<br></li><li>etc etc etc<br></li></ul><p>Und wenn es etwas gab, dann meist auf Windows CE Basis. Es war damals aber<br>schon allgemein bekannt, das Windows CE massive Probleme im Netzwerkbereich hatte.<br>So konnte es beispielsweise abstürzen, wenn es per WLAN eine sehr hohe Anzahl<br>von Access-Points empfängt &mdash; ein Puffer lief über, und man hatte viel Spaß.<br></p><p>Also wollte man dies mit Linux versuchen.<br></p><h2 id=zum-gerät>Zum Gerät<span class=org-target id=org-target--geraet></span></h2><p>Hier zunächst eine Gesamtsicht der drei Komponenten:<br></p><ul><li>Handterminal &ldquo;MNCI&rdquo;<br></li><li>austauschbarer Akku<br></li><li>Docking-Station<br></li></ul><p><figure><img src=./mnci_akku_dock.jpg></figure><br></p><p>Das Gerät hat einen flexiblen &ldquo;Handstrap&rdquo;, damit es gut in der Hand liegt. Im Inneren<br>kann man eine SIM-Karte einstecken &mldr; damals waren die noch etwas größer als heute :-)<br></p><p><figure><img src=./mnci_sim.jpg></figure><br></p><p>Damit ein Fahrer die Abgabe bzw. eventuelle Schäden dokumentieren kann, gibt es eine<br>Kamera. Und natürlich eine Laser-basierten Barcode-Scanner:<br></p><p><figure><img src=./mnci_camera_barcode.jpg></figure><br></p><p>Auf der Front befinden sich<br></p><ul><li>Tastatur<br></li><li>resistiver Touchscreen<br></li><li>Mikrofon und Lautsprecher<br></li></ul><p><figure><img src=./mnci_front.jpg></figure><br></p><p>(und ja, man konnte den MNCI als Telefon nutzen. Eines der klobisten Telefone<br>seiner Zeit &mldr;)<br></p><p>Am unteren Ende gibt es jede Menge Anschlüsse:<br></p><ul><li>USB (beispielsweise zu Barcode-Druckern)<br></li><li>Infrarot (keine Ahnung wofür, wurde von keinem Kunden je verwendet)<br></li><li>externe GSM-Antenne (damit das Gerät während der Fahrt im LKW gute Verbindung bekommt)<br></li><li>Audio-Ausgang (ebenfalls damit man im LKW das Gerät hören kann)<br></li><li>Anschluss gehen zur Docking-Station<br></li></ul><p><figure><img src=./mnci_unten.jpg></figure><br></p><p>Die vielen Pins zur Docking-Station haben einen Grund. Denn dort findet man<br></p><ul><li>Stromversorgung<br></li><li>zwei weitere serielle Ports<br></li><li>einen 10 MB/s Ethernet-Anschluss<br></li><li>eine Aufnahme um einen zweiten Akku laden zu können (der im Gerät wird auch<br>geladen, wenn das Gerät gedockt ist)<br></li></ul><p><figure><img src=./mnci_dock.jpg></figure><br></p><h2 id=bootloader>Bootloader</h2><p>Die PXA320 CPU war mit Intel-StrataFlash ausgerüstet, dort war der Bootloader<br>u-boot, der Kernel und das Journalling Flash Filesystem (JFFS) gespeichert.<br></p><p>Den Bootloader habe ich an das Gerät angepaßt.<br></p><p>Die ersten Schritte waren dann:<br></p><ol><li>einen seriellen Port zum Leben erwecken (für Debug-Ausgaben)<br></li><li>das DRAM initialisieren<br></li><li>den Ethernet-Port initialisieren<br></li></ol><p>Schritt 3 war für die weitere Entwicklung eine große Zeitersparnis. Besonders<br>wenn man neu in einem Feld ist &mdash; Kernel hatte ich schon oft für i386 kompiliert,<br>aber noch nie für armhf &mdash; bekommt man damit einen schnellen Turnaround hin. Man<br>sieht auch an den Debug-Ausgaben des Kernels sofort, ob man noch Treiberprobleme hat.<br></p><p>Als nächstes folgte<br></p><ol start=4><li>dem Kernel eine initrd mit Busybox beigesellen<br></li></ol><p>Damit konnte ich in eine Shell booten, damit waren dann sogar Tools wie &ldquo;<code>i2cget</code>&rdquo; oder<br>&ldquo;<code>lsusb</code>&rdquo; verfügbar.<br></p><h2 id=flashen-via-boundary-scan>Flashen via Boundary-Scan</h2><p>Erst danach habe ich dem u-boot den Zugriff auf das Flash beigebracht.<br></p><p>Geflasht wurde das Gerät über nicht über u-Boot &mldr; sondern über einen BDI2000. Das<br>ist eigentlich ein &ldquo;Boundary-Scan-Device&rdquo;. In diesem Mode werden nahezu alle Pins<br>der CPU von den internen CPU-Blöcken getrennt und an ein Schieberegister gekoppelt.<br>Dort hinein kann der BDI2000 dann Bits hinein- bzw. hinausschieben.<br></p><p>Einerseits kann man Hardware-Tests machen &mldr; man muss dafür keine Leiterbahnen<br>auftrennen und kann jedes Pin des Prozessors messen / setzen.<br></p><p>Andererseits kann man aber auch den Adress- und Datenbus &ldquo;per Hand&rdquo; bedienen und<br>so das Intel-Strataflash ohne Zutun der CPU programmieren. Das ging erstaunlich<br>schnell, ungefähr so schnell wie heute ein ST/LinkV2 das bei STM32-Prozessoren<br>kann.<br></p><h2 id=linux-kernel>Linux-Kernel</h2><p>Ein Linux-Kernel aus der 3.x er Reihe wurde auf das Gerät angepaßt und<br>cross-compiliert. Für die <a href=#org-target--geraet>oben</a> angeführten Geräte mussten natürlich Treiber her:<br></p><ul><li>LCD-Display<br></li><li>Touchscreen<br></li><li>Hintergrundbeleuchtung (PWM)<br></li><li>Akku-Ladestand<br></li><li>serielle Ports (zu GSM, extern, Barcode-Laserscanner)<br></li><li>Kamera<br></li><li>Tastaturmatrix mit (normal, blaue Funktionsebene, rote Funktionsebene)<br></li><li>Audio (Mikrofon, Lautsprecher, via i2s)<br></li><li>USB<br></li><li>Infrarot<br></li><li>Ethernet<br></li></ul><p>Aber es gab noch Geräte, die man auf den Fotos nicht sieht, beispielsweise<br></p><ul><li>RTC (Datum / Uhrzeit)<br></li><li>Compact-Flash an sich<br></li><li>WLAN-Karte in Form einer Compact-Flash Karte auf Basis eines Marvell-Chips<br></li></ul><p>Übrigens war dies zu Zeiten, als Device-Tree im Kernel noch nicht von allen<br>Treibern unterstützt war. Daher war die Implementierung des einen oder<br>anderen Treibers deutlich aufwändiger als heute.<br></p><p>Der Treiber für die Tastaturmatrix war eine gänzlich eigene Entwicklung.<br></p><p>Für den Libertas hatten wir &mdash; dank des <a href=https://de.wikipedia.org/wiki/OLPC_XO-1>One Laptop Per Child</a> Projektes zwar den<br>Source eines Treibers. Das ist gänzlich untypisch für Marvell, die mit<br>Dokumentationen geizt und knausert, es sei denn man macht ein NDA und nimmt<br>10000 Stück ab. Da sie aber ihre WIFI-Chips für OLPC verkaufen wollten, gab es<br>dazu Source &mldr; aber ach, die Qualität &mldr; zusammen mit einem anderen<br>Kernel-Programmierer habe ich dann die Qualität des Treibers drastisch<br>verbessert. Auch wurde die Struktur vereinfacht: vorher wurden manche Funktionen<br>über 3 oder 4 Indirektionen aufgerufen, das war ein wenig undurchsichtig und hat<br>nur unnötig den Code aufgebläht. All dies wurde vereinfacht.<br></p><h2 id=user-space>User-Space</h2><p>Als User-Space kam ein Qt/Embedded Programm, geschrieben mit Qt 3.x zum Einsatz.<br>Es hatte einige allgemeine Einstellmöglichkeiten (z.B. IP-Adresse, SSID) und auch<br>Gerätespezifische (beispielsweise welche Barcodes akzeptiert werden sollten).<br></p><p>Außerdem war ein grafischer<br></p><ul><li>Telnet-Client<br></li><li>TN5250-Client<br></li></ul><p>eingebaut. Telnet wurde damals viel häufiger als heute verwendet. Und der eine<br>oder andere Logistiker hatte AS/400 in Benutzung.<br></p><p>Es gab selbstverständlich auch die Möglichkeit, das der Kunde sich selbst ein<br>Programm programmiert und installiert hätte.<br></p><p>Ich hatte Versuche mit einem Browser auf dem Gerät gemacht, für Webanwendungen.<br>Jedoch war das dann so lahm, das es unbrauchbar war. Weder die Taktfrequenz des<br>PXA320, noch sein DRAM-Throughput, noch die Größe des DRAM waren für<br>Browseranwendungen adequat.<br></p><p>X11 wurde nicht installiert, auch das war zu langsam.<br></p><h2 id=projektende>Projektende</h2><p>Scheinbar hat die Chefin von M&amp;N mit dem Logistiker eine schlechte Übereinkunft<br>gemacht, denn uns wurde nicht die Entwicklungszeit bezahlt, sondern<br>Geräteabnahme versprochen. Auf Handschlag.<br></p><p>Nur stellte es sich heraus, das der Handschlag für den süddeutschen Logistiker<br>nichts wert war. Auf einmal waren wir ihn zu klein und popelig, mit unseren 30<br>Leuten. Er hingegen wäre ja groß, mit Niederlassungen auf der ganzen Welt.<br></p><p>Es muss betont werden, das das Gerät in Revision 4 vollkommen funktionierte,<br>technisch gab es keine Beanstandungen. Weder von ihm noch von anderen Kunden.<br></p><p>Da die Entwicklung von M&amp;N teilweise kreditfinanziert war, dann aber kein<br>größerer Umsatz kam, wurde M&amp;N in die Insolvenz getrieben. Zwar wurden einige<br>MNCI-Geräte an andere Kunden verkauft. Aber zu wenige. Ein wirtschaftlicher<br>Erfolg stellte sich nicht ein.<br></p><h2 id=verwandte-projekte>Verwandte Projekte</h2><p>Die folgenden Projekte sind verwandt mit diesem Projekt:<br></p><ul><li><a href=../../de/openembedded/>OpenEmbedded</a><br></li><li>TODO(Artikel schreiben) WLAN-Treiber &ldquo;Libertas&rdquo;</li></ul><div class=post-meta><div><i class="fa fa-copyright fa-fw"></i>
License: <a href=https://spdx.org/licenses/CC-BY-SA-4.0.html target=_blank>CC-BY-SA 4.0</a></div><div><i class="fa fa-calendar fa-fw"></i>
<time>2024-01-20</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=../../categories/job>job</a>
<a class=rss type=application/rss+xml href=../../categories/job/index.xml><span class="fa fa-rss">RSS</span></a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=../../tags/arm>arm</a>
<a class=rss type=application/rss+xml href=../../tags/arm/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/bdi2000>bdi2000</a>
<a class=rss type=application/rss+xml href=../../tags/bdi2000/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/boundary-scan>boundary-scan</a>
<a class=rss type=application/rss+xml href=../../tags/boundary-scan/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/c>c</a>
<a class=rss type=application/rss+xml href=../../tags/c/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/c++>c++</a>
<a class=rss type=application/rss+xml href=../../tags/c++/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/embedded>embedded</a>
<a class=rss type=application/rss+xml href=../../tags/embedded/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/libertas>libertas</a>
<a class=rss type=application/rss+xml href=../../tags/libertas/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/linux>linux</a>
<a class=rss type=application/rss+xml href=../../tags/linux/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/openembedded>openembedded</a>
<a class=rss type=application/rss+xml href=../../tags/openembedded/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/pxa320>pxa320</a>
<a class=rss type=application/rss+xml href=../../tags/pxa320/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/qt>qt</a>
<a class=rss type=application/rss+xml href=../../tags/qt/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/qt/embedded>qt/embedded</a>
<a class=rss type=application/rss+xml href=../../tags/qt/embedded/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/telnet>telnet</a>
<a class=rss type=application/rss+xml href=../../tags/telnet/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/tn5250>tn5250</a>
<a class=rss type=application/rss+xml href=../../tags/tn5250/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/u-boot>u-boot</a>
<a class=rss type=application/rss+xml href=../../tags/u-boot/index.xml><span class="fa fa-rss">RSS</span></a></div></div></div></div></div><script src=../../js/ui.js></script><script src=../../js/menus.js></script></body></html>