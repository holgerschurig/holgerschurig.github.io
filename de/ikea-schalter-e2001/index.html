<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.139.4"><title>Home-Assistant: IKEA Schalter Styrbar E2001 &#183; Holger Schurig's Computer Calisthenics & Orthodontia</title>
<link rel=stylesheet href=../../css/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=../../css/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=../../css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/side-menu.css><!--<![endif]--><link rel=stylesheet href=../../css/blackburn.css><link rel=stylesheet href=../../css/all.min.css><link rel=alternate type=application/rss+xml title="Holger Schurig's Computer Calisthenics & Orthodontia" href=../../index.xml><link rel="shortcut icon" href=../../img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=../../><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../en/><i class='fa fa-list fa-fw'></i>Articles</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../de/><i class='fa fa-list fa-fw'></i>Beiträge</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../categories/><i class='fa fa-folder fa-fw'></i>Categories</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../impressum/><i class='fa fa-phone fa-fw'></i>Impressum</a></li></ul></div></div><div id=main><div class=header><h1>Home-Assistant: IKEA Schalter Styrbar E2001</h1><h2></h2></div><div class=content><p>Hier geht es um den IKEA Schalter &ldquo;Styrbar&rdquo; E2001.</p><p>Und um 4 sehr verschiedene Arten, auf Tastendrücke zu reagieren
(Action, Pyscript, Switch Manager, Blueprint).</p><div class="ox-hugo-toc toc"><div class=heading>Table of Contents</div><ul><li><a href=#abmessungen>Abmessungen</a></li><li><a href=#einkauf>Einkauf</a></li><li><a href=#batterie>Batterie</a></li><li><a href=#einbindung-in-home-assistant-problemlos>Einbindung in Home-Assistant - problemlos!</a></li><li><a href=#nutzung-in-home-assistant-anspruchsvoll>Nutzung in Home-Assistant - anspruchsvoll!</a></li><li><a href=#entities-in-home-assistant>Entities in Home-Assistant</a></li><li><a href=#tasten-events-herausfinden>Tasten-Events herausfinden</a></li><li><a href=#tasten-events-herausfinden--mit-mehr-details>Tasten-Events herausfinden (mit mehr Details)</a><ul><li><a href=#oben>Oben</a></li><li><a href=#links>Links</a></li><li><a href=#rechts>Rechts</a></li><li><a href=#unten>Unten</a></li></ul></li><li><a href=#tastenevents-nutzen>Tastenevents nutzen</a><ul><li><a href=#in-aktion-den-trigger-setzen>In Aktion den Trigger setzen</a></li><li><a href=#pyscript-von-hacs-f%C3%BCr-programmierer>&ldquo;Pyscript&rdquo; von HACS - für Programmierer</a></li><li><a href=#switch-manager-von-hacs-einfach>&ldquo;Switch Manager&rdquo; von HACS - einfach!</a></li><li><a href=#blueprints>Blueprints</a></li></ul></li><li><a href=#kaufempfehlung>Kaufempfehlung?</a></li></ul></div><h2 id=abmessungen>Abmessungen</h2><p>Der Schalter misst ca. 7 cm im Quadrad und ist ca. 1.5 cm hoch</p><figure><img src=./e2001.jpeg></figure><h2 id=einkauf>Einkauf</h2><p>Ich habe den Schalter bei IKEA in Frankfurt selbst
gekauft. Den Preis habe ich vergessen, im Dez. 2024 kostet er knapp 10
EUR.</p><h2 id=batterie>Batterie</h2><p>Es werden 2 AAA Batterien gebraucht.</p><p>Ich habe derzeit noch Alkaline (Wegwerf) Batterien drin und kann also
nicht sagen, ob aufladbare NiMH auch funktionieren würden.</p><p>Die Batterie wird in 1er Schritten zwischen 0% und 100% übermittelt.
Zumindest glaube ich das, aber meine Home-Assistant interne History
zeigt für die gespeicherten 3 Tage immer 90% an.</p><p>Ich nutze den Taster jetzt schon seit einem dreiviertel Jahr.</p><h2 id=einbindung-in-home-assistant-problemlos>Einbindung in Home-Assistant - problemlos!</h2><p>Das Gerät wird von Zigbee2MQTT ohne Probleme erkannt und eingebunden.</p><p>Siehe auch: <a href=https://www.zigbee2mqtt.io/devices/E2001_E2002.html>https://www.zigbee2mqtt.io/devices/E2001_E2002.html</a></p><p>Man kann dann in Zigbee2MQTT diese Geräte-Details sehen:</p><figure><img src=./e2001-zigbee2mqtt.png></figure><h2 id=nutzung-in-home-assistant-anspruchsvoll>Nutzung in Home-Assistant - anspruchsvoll!</h2><h2 id=entities-in-home-assistant>Entities in Home-Assistant</h2><p>In Home-Assistant findet man dann ähnlich Entities:</p><figure><img src=./e2001-entities.png></figure><p>Die wichtige für die Automatisierung ist hier die mit &ldquo;<code>_action</code>&rdquo; am
Ende.</p><h2 id=tasten-events-herausfinden>Tasten-Events herausfinden</h2><p>Doch welche Aktionen sind bei der &ldquo;<code>_action</code>&rdquo; Entity möglich? Das
können wir herausfinden:</p><ul><li>Settings</li><li>Devices & services</li><li>Devices</li><li>&ldquo;Styrbar&rdquo; suchen und klicken</li></ul><p>Auf der rechten Seite sieht man dann im Logbook die Events:</p><figure><img src=./e2001-events.png></figure><h2 id=tasten-events-herausfinden--mit-mehr-details>Tasten-Events herausfinden (mit mehr Details)</h2><p>Wenn man mehr Details sehen will, geht man dorthin:</p><ul><li>Developer Tools</li><li>Events</li><li>Listen to Events</li><li>&ldquo;state_changed&rdquo; eintragen</li><li>Start Listening</li></ul><p>und drücken die obere Taste (die mit der Vertiefung) dann sehen wir:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>vent_type: state_changed
</span></span><span style=display:flex><span>data:
</span></span><span style=display:flex><span>  entity_id: sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>  old_state:
</span></span><span style=display:flex><span>    entity_id: sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>    state: &#34;&#34;
</span></span><span style=display:flex><span>    attributes:
</span></span><span style=display:flex><span>      icon: mdi:gesture-double-tap
</span></span><span style=display:flex><span>      friendly_name: IKEA STYRBAR 4fach Taster Action
</span></span><span style=display:flex><span>    last_changed: &#34;2024-12-04T09:28:26.697913+00:00&#34;
</span></span><span style=display:flex><span>    last_reported: &#34;2024-12-04T09:28:26.697913+00:00&#34;
</span></span><span style=display:flex><span>    last_updated: &#34;2024-12-04T09:28:26.697913+00:00&#34;
</span></span><span style=display:flex><span>    context:
</span></span><span style=display:flex><span>      id: 01JE8FZPA9GTNNPJV4D8FFA02Z
</span></span><span style=display:flex><span>      parent_id: null
</span></span><span style=display:flex><span>      user_id: null
</span></span><span style=display:flex><span>  new_state:
</span></span><span style=display:flex><span>    entity_id: sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>    state: &#34;on&#34;
</span></span><span style=display:flex><span>    attributes:
</span></span><span style=display:flex><span>      icon: mdi:gesture-double-tap
</span></span><span style=display:flex><span>      friendly_name: IKEA STYRBAR 4fach Taster Action
</span></span><span style=display:flex><span>    last_changed: &#34;2024-12-04T09:30:01.098844+00:00&#34;
</span></span><span style=display:flex><span>    last_reported: &#34;2024-12-04T09:30:01.098844+00:00&#34;
</span></span><span style=display:flex><span>    last_updated: &#34;2024-12-04T09:30:01.098844+00:00&#34;
</span></span><span style=display:flex><span>    context:
</span></span><span style=display:flex><span>      id: xxxxxxxxxxxxxxxxxxxxxxxxxx
</span></span><span style=display:flex><span>      parent_id: null
</span></span><span style=display:flex><span>      user_id: null
</span></span><span style=display:flex><span>origin: LOCAL
</span></span><span style=display:flex><span>time_fired: &#34;2024-12-04T09:30:01.098844+00:00&#34;
</span></span><span style=display:flex><span>context:
</span></span><span style=display:flex><span>  id: xxxxxxxxxxxxxxxxxxxxxxxxxx
</span></span><span style=display:flex><span>  parent_id: null
</span></span><span style=display:flex><span>  user_id: null
</span></span></code></pre></div><p>Beim Loslassen dasselbe, nur steht da halt unter &ldquo;new_state.state&rdquo;
kein <code>"on"</code> mehr, sondern der leere String <code>""</code>.</p><p>Und das reicht nun aus, um eine Automatisierung zu erstellen.</p><p>Wichtig: die 4 Tasten erzeugen unterschiedliche Datensätze. Hier mal
die Datensätze beim kurzen Tippen. Beim langen Tippen kommen andere
Datensätze. Und weil die wenigesten Zeilen von oben gebraucht werden,
hier nur das Relevante:</p><h3 id=oben>Oben</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>...
</span></span><span style=display:flex><span>date:
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>   new_state:
</span></span><span style=display:flex><span>     entity_id: sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>     state: &#34;on&#34;
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=links>Links</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>...
</span></span><span style=display:flex><span>date:
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>   new_state:
</span></span><span style=display:flex><span>     entity_id: sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>     state: arrow_left_click
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=rechts>Rechts</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>...
</span></span><span style=display:flex><span>date:
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>   new_state:
</span></span><span style=display:flex><span>     entity_id: sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>     state: arrow_roght_click
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=unten>Unten</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>...
</span></span><span style=display:flex><span>date:
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>   new_state:
</span></span><span style=display:flex><span>     entity_id: sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>     state: &#34;off&#34;
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Eher nicht wichtig, aber doch bemerkenswert: manchmal kommt der State in
Gänsefüßchen. Und manchmal nicht.</p><h2 id=tastenevents-nutzen>Tastenevents nutzen</h2><p>Nun wissen wir, was die Tasten so senden. Und nun wollen wir natürlich
darauf reagieren.</p><h3 id=in-aktion-den-trigger-setzen>In Aktion den Trigger setzen</h3><ul><li>Settings</li><li>Automations & Scenes</li><li>Automations</li><li>Create Automation</li><li>&ldquo;When&rdquo; öffnen</li><li>den IKEA-Taster in der ersten Entity auswählen</li><li>zweites Entity-Feld leer lassen</li><li>&ldquo;Attribute&rdquo; leer lassen</li><li>&ldquo;From&rdquo; leer lassen</li><li>&ldquo;To&rdquo; mit <code>on</code> füllen. Auch wenn im Log oben <code>"on"</code> stand, braucht
man hier im GUI keine Gänsefüßchen</li><li>bei &ldquo;Then do&rdquo; passende Dinge ausfüllen</li></ul><p>Oder grafisch:</p><figure><img src=./e2001-trigger.png></figure><p>Oder in YAML:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>alias: TEST STYRBAR
</span></span><span style=display:flex><span>description: &#34;&#34;
</span></span><span style=display:flex><span>triggers:
</span></span><span style=display:flex><span>  - trigger: state
</span></span><span style=display:flex><span>    entity_id:
</span></span><span style=display:flex><span>      - sensor.ikea_styrbar_4fach_taster_action
</span></span><span style=display:flex><span>    to: &#34;on&#34;
</span></span><span style=display:flex><span>conditions: []
</span></span><span style=display:flex><span>actions:
</span></span><span style=display:flex><span>  - action: switch.toggle
</span></span><span style=display:flex><span>    metadata: {}
</span></span><span style=display:flex><span>    data: {}
</span></span><span style=display:flex><span>    target:
</span></span><span style=display:flex><span>      entity_id: switch.neo_steckdose_1
</span></span><span style=display:flex><span>mode: single
</span></span></code></pre></div><h3 id=pyscript-von-hacs-für-programmierer>&ldquo;Pyscript&rdquo; von HACS - für Programmierer</h3><p>Da ich ja Programmierer bin, finde ich es oft umständlich, mir über
ein GUI etwas zusammenzuklicken, was doch in einer Programmiersprache
recht einfach wäre. Also habe ich mir in HACS mal <a href=https://github.com/custom-components/pyscript>pyscript</a>
installiert und nach deren Anleitung installiert.</p><p>Und dann kann man so auf die Taste reagieren. Hier ein Auszug aus
meiner &ldquo;<code>pyscript/regalbeleuchtung.py", die sich wiederum im "=/config</code>&rdquo; meines Home-Assistant befindet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>@state_trigger(&#34;sensor.ikea_styrbar_4fach_taster_action == &#39;on&#39;&#34;)
</span></span><span style=display:flex><span>def regal_an_py(**kwargs):
</span></span><span style=display:flex><span>  switch.toggle(entity_id=&#34;switch.neo_steckdose_1&#34;)
</span></span></code></pre></div><p>Das ganze sind drei Zeilen, viel einfacher als das YAML oben.</p><p>In Wirklichkeit ist die Datei noch ein wenig größer, da ich oft Links
auf Doku oder Hinweise zum Debuggen mit aufnehme:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># https://hacs-pyscript.readthedocs.io/en/stable/tutorial.html
</span></span><span style=display:flex><span>#
</span></span><span style=display:flex><span># See log.XXX() output with: tail -f /homeassistant/home-assistant.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># https://hacs-pyscript.readthedocs.io/en/stable/reference.html#state-trigger
</span></span><span style=display:flex><span>@state_trigger(&#34;sensor.ikea_styrbar_4fach_taster_action == &#39;on&#39;&#34;)
</span></span><span style=display:flex><span>def regal_an_py(**kwargs):
</span></span><span style=display:flex><span>  # log.warning(f&#34;mymqtt {kwargs}&#34;)
</span></span><span style=display:flex><span>  switch.toggle(entity_id=&#34;switch.neo_steckdose_1&#34;)
</span></span></code></pre></div><ul><li>sobald ich eine neues Script von meinem Editor in die Home-Assistant
VM auf Proxmoxx kopiere ist sie bereits aktiv. Man muss nichts in
den Developer-Tools neuladen</li><li>oben steht ein &ldquo;tail -f&rdquo;-Befehl. Dort würde man die typischen
Python-Fehler sehen, wenn man Syntax-Fehler drin hat</li><li>den auskommentiere &ldquo;<code>log.warning(...)</code>&rdquo; Befehl kann man aktivieren,
um zusätzliche Debug-Info zu bekommen.</li></ul><p>Also, für <strong>mich</strong> als Programmierer ist das einfach. Aber es geht noch einfacher:</p><h3 id=switch-manager-von-hacs-einfach>&ldquo;Switch Manager&rdquo; von HACS - einfach!</h3><p>Seit einiger Zeit gibt es eine einfachere Möglichkeit. Im
Home-Assistant Community Store (HACS) findet man den
<a href=https://github.com/Sian-Lee-SA/Home-Assistant-Switch-Manager>Switch Manager</a>. Sobald er installiert ist, findet man &ldquo;Switch Manager&rdquo;
im Sidebar und kann dort mit &ldquo;Add Switch&rdquo; einen von vielen Switches
hinzufügen.</p><p>Das habe ich mit diesem IKEA Switch getan und bekomme dann dieses GUI:</p><figure><img src=./e2001-switch-manager.png></figure><p>Ich klicke dann zunächst einen der Buttons (hier ist gerade der obere
aktiv). Und dann kann ich unten drei verschiedene Aktion für</p><ul><li>Press (kurzes Tippen)</li><li>Hold (langes Anhalten &mldr; Aktion wird gestartet sobald langes Halten
erkannt wird)</li><li>Release (langes Anhalt &mldr; Aktion wird beim Loslassen gestartet)</li></ul><p>definieren.</p><p>Einfacher geht&rsquo;s nicht!</p><h3 id=blueprints>Blueprints</h3><p>Diese möchte ich nur erwähnen. Wenn man nach <a href="https://letmegooglethat.com/?q=home-assistant+styrbar+blueprint">home-assistant styrbar
bluebprint</a> sucht, findet man einige Treffer. Sie haben aber nicht
exakt das getan, was ich wollte. Beispielsweise steuere ich über
diesen Taste sowohl meine Regalbeleuchtung als auch mein (fast)
werbefreies Internet-Radio. Das Blueprint, das ich gefunden hatte,
wollte damit nur Licht steuern.</p><h2 id=kaufempfehlung>Kaufempfehlung?</h2><p><strong>Ja</strong>, ich finde diesen Schalter für den Preis voll in Ordnung.</p><p>Durch die Metallkappe hat er keine Billigst-Anmutung.</p><p>An die Wand kleben (als Ersatz für einen normalen Lichtschalter) würde
ich ihn aber nicht wollen. Aber so wandert er von meinen
Programmier-Schreibtisch auf den
Für-die-Firma-programmieren-Schreibtisch oder zum Couchtisch. Je
nachdem, wo ich ihn gerade brauche.</p><p>Als Fernsteuerung für mein (fast) werbefreies Internet-Radio ist er
viel besser als eine Infrarot-Fernbedienung es wäre.</p><div class=post-meta><div><i class="fa fa-copyright fa-fw"></i>
License: <a href=https://spdx.org/licenses/CC-BY-SA-4.0.html target=_blank>CC-BY-SA 4.0</a></div><div><i class="fa fa-calendar fa-fw"></i>
<time>2024-12-04</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=../../categories/home-assistant>home-assistant</a>
<a class=rss type=application/rss+xml href=../../categories/home-assistant/index.xml><span class="fa fa-rss">RSS</span></a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=../../tags/steckdose>Steckdose</a>
<a class=rss type=application/rss+xml href=../../tags/steckdose/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/zigbee>Zigbee</a>
<a class=rss type=application/rss+xml href=../../tags/zigbee/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/ikea>Ikea</a>
<a class=rss type=application/rss+xml href=../../tags/ikea/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/styrbar>Styrbar</a>
<a class=rss type=application/rss+xml href=../../tags/styrbar/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/e2001>E2001</a>
<a class=rss type=application/rss+xml href=../../tags/e2001/index.xml><span class="fa fa-rss">RSS</span></a></div></div></div></div></div><script src=../../js/ui.js></script><script src=../../js/menus.js></script></body></html>