<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.139.3"><title>flexibler Hardware-Tester für x86-Systeme: hwtester &#183; Holger Schurig's Computer Calisthenics & Orthodontia</title>
<link rel=stylesheet href=../../css/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=../../css/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=../../css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/side-menu.css><!--<![endif]--><link rel=stylesheet href=../../css/blackburn.css><link rel=stylesheet href=../../css/all.min.css><link rel=alternate type=application/rss+xml title="Holger Schurig's Computer Calisthenics & Orthodontia" href=../../index.xml><link rel="shortcut icon" href=../../img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=../../><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../en/><i class='fa fa-list fa-fw'></i>Articles</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../de/><i class='fa fa-list fa-fw'></i>Beiträge</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../categories/><i class='fa fa-folder fa-fw'></i>Categories</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../impressum/><i class='fa fa-phone fa-fw'></i>Impressum</a></li></ul></div></div><div id=main><div class=header><h1>flexibler Hardware-Tester für x86-Systeme: hwtester</h1><h2></h2></div><div class=content><p>Hier geht es darum, frisch produzierte Geräte der Klassen DLT-V83 und DLT-V72
auf Herz und Nieren zu prüfen.</p><div class="ox-hugo-toc toc"><div class=heading>Table of Contents</div><ul><li><a href=#projekt-info>Projekt-Info</a></li><li><a href=#anforderungen>Anforderungen</a></li><li><a href=#image-erstellen>Image erstellen</a></li><li><a href=#automatisiert-usb-stick-erstellen>automatisiert USB-Stick erstellen</a></li><li><a href=#tests>Tests</a><ul><li><a href=#testpl%C3%A4tze>Testplätze</a></li><li><a href=#testarten>Testarten</a></li><li><a href=#ger%C3%A4te>Geräte</a></li><li><a href=#aufbau-der-tests>Aufbau der Tests</a></li></ul></li><li><a href=#kommunikation-mit-test-fixture>Kommunikation mit Test-Fixture</a></li><li><a href=#testreport-abspeichern>Testreport abspeichern</a></li><li><a href=#verwandte-projekte>Verwandte Projekte</a></li></ul></div><div class=job><p>In Beiträgen der Kategorie <a href=../../categories/job/>Job</a> trage ich Projekte zusammen, die ich im Rahmen
meiner beruflichen Karriere federführend durchgeführt habe. Ich gehe dabei mit
Absicht nicht allzu sehr auf Details an: die Interessen meiner Arbeitgeber sollen
ja nicht berührt werden.</p></div><h2 id=projekt-info>Projekt-Info</h2><p>Idee: Leiter der Elektronikentwicklung</p><p>Umsetzung: ich (Programmierung), allerdings mit viel Input von der Fertigung, Reparatur-Abteilung und Qualitätssicherung &mdash; ein echtes Team-Projekt</p><p>Nutzung: 2013 bis heute</p><p>Implementierung: Combined-Linux, Bash, Python, C, C++</p><p>Effizienzgewinn:</p><ul><li>erstmals wurden alle hergestellten Geräte systematisch und reproduzierbar getestet</li><li>viele Produktionsfehler wurden frühzeitig herausgefunden, teilweise schon beim
Lieferanten der Hauptplatine</li><li>für jedes Gerät und Test gab es einen Testreport, da war die
Qualitätssicherung sehr erfreut</li></ul><h2 id=anforderungen>Anforderungen</h2><ul><li>bootet von einem USB-Stick beliebiger Größe</li><li>musst an verschiedenen Testorten verschiedene Tests (automatisch) aktivieren bzw. deaktivieren</li><li>muss verbaute Hardware weitestgehend erkennen</li><li>32bit wg. externer Test-Tools</li><li>die kommerzielle Testsoftware &ldquo;Toolstar TestLX&rdquo; musste eingebunden werden</li><li><strong>keine</strong> Anbindung an die Auftragsverwaltung (wurde so nicht gewünscht)</li></ul><h2 id=image-erstellen>Image erstellen</h2><p>Das Image wird dem Tool</p><p><a href=../../de/mkimage/>automatisch Images erstellen</a></p><p>erstellt. Statt nur
&ldquo;<code>bin/run</code>&rdquo; auszuführen wird gibt man einfach eine Konfigurationsdatei an:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>~/d/mkimage$ bin/run -c conf/hwtester.imgconf
</span></span></code></pre></div><h2 id=automatisiert-usb-stick-erstellen>automatisiert USB-Stick erstellen</h2><p>Anschließend hat man das Image im Verzeichnis &ldquo;<code>image.hwtester/</code>&rdquo;. Doch wie bringt man das nun auf einen Stick?
Indem wir es eine Image verwandeln:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-1><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-2><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-3><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-4><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-5><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-6><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-7><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-8><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-9><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-10><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-11><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-12><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-13><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-14><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-15><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-16><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-17><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># make -n hda
</span></span><span style=display:flex><span>rm -f hda
</span></span><span style=display:flex><span>fallocate -l 640M hda
</span></span><span style=display:flex><span>dd bs=440 conv=notrunc count=1 if=/usr/lib/EXTLINUX/gptmbr.bin of=hda.hwtester
</span></span><span style=display:flex><span>sgdisk hda --new 1::600M --typecode=1:8300   # 8300: Linux filesystem
</span></span><span style=display:flex><span>sgdisk hda --change-name=1:&#34;Linux filesystem&#34;
</span></span><span style=display:flex><span>sgdisk hda --partition-guid=1:6f8f4e09-84df-3804-1c41-38f20001b6c8
</span></span><span style=display:flex><span>sgdisk hda --attributes 1:set:2
</span></span><span style=display:flex><span>losetup -D
</span></span><span style=display:flex><span>kpartx -sva hda
</span></span><span style=display:flex><span>losetup /dev/loop1 /dev/mapper/loop0p1
</span></span><span style=display:flex><span>mke2fs -j /dev/loop1
</span></span><span style=display:flex><span>tune2fs -i 0 /dev/loop1
</span></span><span style=display:flex><span>tune2fs -c 0 /dev/loop1
</span></span><span style=display:flex><span>sync
</span></span><span style=display:flex><span>losetup -d /dev/loop1
</span></span><span style=display:flex><span>kpartx -sd hda
</span></span></code></pre></td></tr></table></div></div><ul><li>Zeile <a href=#org-coderef--0a417f-2>2</a>: zuerst löschen wir eine eventuelle alte &ldquo;<code>hda</code>&rdquo; Datei</li><li>Zeile <a href=#org-coderef--0a417f-3>3</a>: dann wird eine neue angelegt. 640 MB reichen dicke aus. Wir
verwenden fallocate, weil es schneller als &ldquo;<code>dd if=/dev/zero ...</code>&rdquo; ist. Es
alloziert nur die Blöcke, beschriebt sie aber nicht. Der Linux-Kernel selbst
sorgt dafür, das nur 0x00 Bytes enthalten sind.</li><li>Zeile <a href=#org-coderef--0a417f-4>4</a>: nun wird aus dem Host-System der EXTLINUX Bootloader an die
richtige Position der &ldquo;<code>hda</code>"-Datei kopiert. &ldquo;EXTLINUX&rdquo; ist weniger komplex
als Grub und für Industrieanwendungen vorzuziehen.</li><li>Zeile <a href=#org-coderef--0a417f-5>5</a>: nun wird mit &ldquo;<code>sgdisk</code>&rdquo; eine GPT-Partition <strong>in der Datei</strong> &ldquo;<code>hda</code>&rdquo;
erstellt.</li><li>Zeile <a href=#org-coderef--0a417f-9>9</a>: falls man früher noch ein Loopback-Mount hat, wird dies hier
zur Sicherheit mit <a href=https://manpages.debian.org/bookworm/mount/losetup.8.en.html>losetup</a> gelöscht</li><li>Zeile <a href=#org-coderef--0a417f-10>10</a>: der Befehl <a href=https://manpages.debian.org/bookworm/kpartx/kpartx.8.en.html>kpartx</a> macht nun die normale Datei &ldquo;<code>hda</code>&rdquo; dem
Kernel bekannt. Er denkt nun sozusagen, das diese Datei ein Blockdevice ist.
Der Kernel ließt die Partition von &ldquo;<code>hda</code>&rdquo; und erstellt
für jede Partition ein Loopback-Device in &ldquo;<code>/dev/mapper/</code>&rdquo;.</li><li>Zeile <a href=#org-coderef--0a417f-11>11</a>: dieses Partition-Loopback-Device mappen wir nun mit <a href=https://manpages.debian.org/bookworm/mount/losetup.8.en.html>losetup</a>, damit wir
darauf zugreifen können: nun ist Filesystem erstellen oder auch Mounten möglich</li><li>Zeile <a href=#org-coderef--0a417f-12>12</a>: diese Partition wird nun mit ext4 formatiert. Nicht durch
den Namen des Binaries, &ldquo;<code>mke2fs</code>&rdquo; beirren lassen: das &ldquo;<code>-j</code>&rdquo; sorgt dafür, das
ein Journalling-Filesystem angelegt wird, und das ist schon seit Jahren per
Default ext4.</li><li>Zeile <a href=#org-coderef--0a417f-13>13</a>: damit die Mitarbeiter in der Produktion nicht auf irgendwelche
fsck&rsquo;s warten müssen, wird das Interval- und Zeitbasierte Prüfen des
Filesystems ausgeschaltet. Es ist sowieso nicht möglich, da der Stick sowieso
mit einem <a href=../../de/dynamischer-flashschutz/>dynamischen Flash-Schutz </a>vor
Schreibzugriffen geschützt ist</li><li>am Schluss löschen wir das loopback-Device und sagen dem Kernel, das &ldquo;<code>hda</code>&rdquo;
nun nichts besonderes mehr ist &mldr; nur eine Datei</li></ul><p>Ein weiteres Makefile-Target &mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># make -n image2hda
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>&mldr; nutzt ebenfalls <a href=https://manpages.debian.org/bookworm/mount/losetup.8.en.html>losetup</a> und <a href=https://manpages.debian.org/bookworm/kpartx/kpartx.8.en.html>kpartx</a>. Aber statt &ldquo;<code>tune2fs</code>&rdquo; wird dann &ldquo;<code>/dev/loop1</code>&rdquo;
einfach nach &ldquo;<code>/mnt</code>&rdquo; gemounted und mit &ldquo;<code>rsync</code>&rdquo; wird alles von &ldquo;<code>image.hwtester/</code>&rdquo; dorthin
synchronisiert. Da dies aber alles trivial ist, lasse ich es mal aus.</p><p>Übrigens: die Datei &ldquo;<code>hda</code>&rdquo; ist sehr klein, sie kann auf 1 GB bis 32 GB Sticks
geschrieben werden:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># lsblk
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span># cat hda &gt;/dev/sdc
</span></span></code></pre></div><p>Übrigens: zum Kopieren von Images auf Sticks braucht man kein &ldquo;<code>dd</code>&rdquo; unter
Linux. Der ganz normale &ldquo;<code>cat</code>&rdquo; Befehl tut es auch. Und er hat eine durchaus
nettere Syntax :-)</p><p>Übrigens 2: Beim ersten Booten wird passt der Stick seine eigene Partition
dynamisch auf die echte Stickgröße an. USB-Sticks haben ja unterschiedliche
echte Größen, bedingt durch Bad-Sector-Management direkt auf dem Stick. Uns
stört das aber nicht.</p><h2 id=tests>Tests</h2><p>Nun haben wir also einen bootenden USB-Stick. Und dort befinden sich in
&ldquo;<code>/usr/local/hwtester</code>&rdquo; alle Test-Scripte, -Binaries etc. Doch bevor wir auf die
eigentlichen Tests eingehen, müssen wir erst einige Konzepte einführen.</p><h3 id=testplätze>Testplätze</h3><p>Hiermit ist nicht gemeint, ob in der Pruduktion 4 oder 8 Leute Geräte zusammenbauen.</p><p>Sondern die verschiedenen Orte, an denen wir Testen möchten:</p><ul><li>nach der Produktion der Hauptplatine &mdash; dies sollte schon beim Herstellungsort
geschehen, um aufwändige Rückliefergen vorzubeugen. Zu diesem Zeitpunkt gibt es
aber keine Front-Platine (Display, Fronttasten, Touch, Defroster). Daher dürfen
Tests dafür hier nicht ablaufen</li><li>Endgerätefertigung nach Kundenwunsch: hier wird ein Mainboard mit der gewünschten
Front zusammengeführt. Je nach Auftrag kann das 10&rdquo;, 12" oder 15" sein. Verschiedene
LCD-Aufläsungen. Verschiedene Anzahl von Tasten auf der Front. Da diese Geräte hinterher
an den Kunden gehen, gibt es auch Sichtprüfungen (&ldquo;Hat die Lackierung einen Kratzer?&rdquo;)</li><li>Service: auch hier sollten Tests ausführbar, aber i.d.R. manuell. Auch dürfen diese Tests
keinerlei Änderungen durchführen. Also nicht automatisch &ldquo;Oh, das BIOS ist veraltet,
ich flash da mal ein Neues drauf&rdquo;. Der Grund liegt darin, das manche Kunden die Geräte
in EXAKT der abgenommenen Konfiguration haben wollen, einschließlich der BIOS-Version</li></ul><p>Man kann nun jeden Test einzeln an einen oder mehrere Testorte (auch an alle) binden.</p><h3 id=testarten>Testarten</h3><p>Naturgemäß gibt es mehrere Tests</p><ul><li>automatische Tests: diese liebt der Leiter der Fertigung. Sie laufen
vollautomatisch ab, oft in Sekundenbruchteilen. Sie sind daher (nahezu)
kostenneutral. Nahezu, weil man für einige dieser Test vorher die passenden
Teststecker einstecken muss. Beispiel: Prüfen der seriellen Schnittstelle.
Automatische Tests werden einer nach den anderen ausgeführt.</li><li>manuelle Tests: hier geht es um Dinge, die man nicht automatisieren kann &mdash;
oder deren Automatisierung zwar an sich möglich ist, sich aber aufgrund der
Stückzahlen nicht lohnt. Beispiel: obige &ldquo;Hat das Gehäuse einen Kratzer?&rdquo;
Abfrage. Auch manuelle Tests werden einer nach den anderen ausgeführt.</li><li>optionale Tests: manchmal ist eine Hardware nur für machen Kunden verbaut,
aber nicht generell. Also muss z.B. der CAN-Test nicht immer ausgeführt
werden. Diese Tests müssen per Menü per Hand ausgewählt werden.</li></ul><p>Man weist nun jeden Test eine Testart zu. Diese kann auch verschieden sein:
viele automatische Tests der Produktion sind optionale Tests im Service.</p><h3 id=geräte>Geräte</h3><p>Bedingt durch die Hardware-Erkennung des zugrundeliegenden
&ldquo;<a href=../../de/combined-linux/> Combined-Linux: ein Image für viele Geräte </a>&rdquo; läuft
der Teststick auf viele Gerätetypen und Varianten. Aber ein i2c-Test für den
DLT-V83 muss natürlich nach anderen Devices suchen als einer für den DLT-V72.</p><p>Man weist nun jeden Test eine oder mehrere Geräte zu.</p><p>Auch kann man einen Test an eine USB- oder PCI-ID binden.</p><h3 id=aufbau-der-tests>Aufbau der Tests</h3><p>Jeder Test ist ein einzelnes File im &ldquo;<code>tests/</code>&rdquo; Verzeichnis, für sich abgeschlossen. Die
Komplexität der Tests ist i.d.R. gering, zwischen 10 und 330 Programmzeilen. Je nach dem,
was einfacher war, wurden sie in Bash oder Python geschrieben.</p><p>Jeder Test hat speziell formatierte Kommentare, die Testorte, Testarten und Geräte definieren.
Hier ein Beispiel für &ldquo;<code>report_cpu_snr.sh</code>&rdquo;:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test: auto everywhere G7I??C??</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>. lib.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>head <span style=color:#e6db74>&#34;CPU board serial number&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./amidelnx_26_32 /BS | grep Done <span style=color:#f92672>||</span> error <span style=color:#e6db74>&#34;cannot get SNR&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok <span style=color:#e6db74>&#34;done&#34;</span>
</span></span></code></pre></div><p>Das ist ein automatischer Test, der an jedem Testort ausgeführt werden soll,
jedoch nur für die Geräteklasse G7I??C??.</p><p>Derselbe &ldquo;<code>^# Test:</code>"-Marker würde auch in einem Python-Test verwendet werden.
Dort werden meist komplexere Dinge getestet, welche in Bash nicht so einfach zu
lösen sind. Hier ein Beispiel:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/python2.7</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test: auto everywhere M7I??A??</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test: auto everywhere G7I?????</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> lib <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> glob <span style=color:#f92672>import</span> glob
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>head(<span style=color:#e6db74>&#34;CPU temperature in range?&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WANTSMIN <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>WANTSMAX <span style=color:#f92672>=</span> <span style=color:#ae81ff>65</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>acpitz</span>():
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>coretemp</span>():
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> hwmatch(<span style=color:#e6db74>&#34;M7I??A??&#34;</span>):
</span></span><span style=display:flex><span>  value <span style=color:#f92672>=</span> acpitc()
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>  value <span style=color:#f92672>=</span> coretemp()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> value <span style=color:#f92672>&lt;</span> WANTSMIN:
</span></span><span style=display:flex><span>        error(<span style=color:#e6db74>&#34;CPU temperature too low: </span><span style=color:#e6db74>%.1f</span><span style=color:#e6db74> °C&#34;</span> <span style=color:#f92672>%</span> value)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> value <span style=color:#f92672>&gt;</span> WANTSMAX:
</span></span><span style=display:flex><span>        error(<span style=color:#e6db74>&#34;CPU temperature too high: </span><span style=color:#e6db74>%.1f</span><span style=color:#e6db74> °C&#34;</span> <span style=color:#f92672>%</span> value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok(<span style=color:#e6db74>&#34;CPU temperature between </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> and </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>: </span><span style=color:#e6db74>%.1f</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (WANTSMIN, WANTSMAX, value))
</span></span></code></pre></div><p>Jaaaa, hier wird noch Python 2.7 verwendet. Bei Projektstart war Python 3 noch
nicht soweit.</p><h2 id=kommunikation-mit-test-fixture>Kommunikation mit Test-Fixture</h2><p>Am Produktionsplatz der Hauptplatine für den DLT-V83 gab es auch ein
Test-Fixture. Dieses hat mit dem Teststick über ein serielles Kabel
kommunuziert. Die Testsoftware dort hat dann bei mir z.B. &ldquo;Mach mal ordentlich
CPU-Last&rdquo; angefordert und dann z.B. den aufgenommenen Strom gemessen, während
mein Testprogramm die Coretemp währenddessen gemessen hat.</p><h2 id=testreport-abspeichern>Testreport abspeichern</h2><p>Nachdem alle Tests durchgeführt gab, hat der Produktionsmitarbeiter &ldquo;Finalize
Tests&rdquo; ausgeführt. Damit wurde dann ein Testprotokoll per SMB oder FTP auf einem
Server im Produktionsnetz (vom Firmennetz getrennt!) gespeichert.</p><p>Dort waren natürlich alle Testergebisse, aber man konnte auch nachvollziehen
oder ein optionaler Test ausgeführt worden ist &mldr; oder nicht.</p><p>Neben reinen Testergebnissen wurden dort auch viele Informationen abgespeichert,
beispielsweise die MAC-Adresse der Ethernet- und WIFI-Ports &mdash; so haben wir
z.B. bemerkt, das wir einmal viele Mainboards mit identischen MAC-Adressen
geliefert bekamen.</p><h2 id=verwandte-projekte>Verwandte Projekte</h2><p>Die folgenden Projekte sind mit dem &ldquo;<code>hwtester</code>&rdquo; verwandt, weil er entweder
darauf aufbaut, es nutzt oder das Projekt extrem ähnlich ist.</p><ul><li><a href=../../de/combined-linux/>Combined-Linux: ein Image für viele Geräte</a></li><li><a href=../../de/mkimage/>automatisch Images erstellen</a></li><li><a href=../../de/dynamischer-flashschutz/>Dynamischer Flash-Schutz</a></li><li>TODO(Artikel schreiben) Hardware-Teststick für DLT-V73</li></ul><p>Die Projekte, die mit diesem Tool erstellte Images verwenden zähle ich jetzt mal
nicht auf :-)</p><div class=post-meta><div><i class="fa fa-copyright fa-fw"></i>
License: <a href=https://spdx.org/licenses/CC-BY-SA-4.0.html target=_blank>CC-BY-SA 4.0</a></div><div><i class="fa fa-calendar fa-fw"></i>
<time>2024-01-18</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=../../categories/job>job</a>
<a class=rss type=application/rss+xml href=../../categories/job/index.xml><span class="fa fa-rss">RSS</span></a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=../../tags/linux>linux</a>
<a class=rss type=application/rss+xml href=../../tags/linux/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/kernel>kernel</a>
<a class=rss type=application/rss+xml href=../../tags/kernel/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/systemd>systemd</a>
<a class=rss type=application/rss+xml href=../../tags/systemd/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/make>make</a>
<a class=rss type=application/rss+xml href=../../tags/make/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/debian>debian</a>
<a class=rss type=application/rss+xml href=../../tags/debian/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/dpkg>dpkg</a>
<a class=rss type=application/rss+xml href=../../tags/dpkg/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/eatmydata>eatmydata</a>
<a class=rss type=application/rss+xml href=../../tags/eatmydata/index.xml><span class="fa fa-rss">RSS</span></a></div></div></div></div></div><script src=../../js/ui.js></script><script src=../../js/menus.js></script><script src=../../js/math-code.js></script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>