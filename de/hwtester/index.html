<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.121.2"><title>flexibler Hardware-Tester für x86-Systeme: hwtester &#183; Holger Schurig's Computer Calisthenics & Orthodontia</title>
<link rel=stylesheet href=../../css/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=../../css/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=../../css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=../../css/side-menu.css><!--<![endif]--><link rel=stylesheet href=../../css/blackburn.css><link rel=stylesheet href=../../css/all.min.css><link rel=alternate type=application/rss+xml title="Holger Schurig's Computer Calisthenics & Orthodontia" href=../../index.xml><link rel="shortcut icon" href=../../img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=../../><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../en/><i class='fa fa-list fa-fw'></i>Articles</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../de/><i class='fa fa-list fa-fw'></i>Beiträge</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../categories/><i class='fa fa-folder fa-fw'></i>Categories</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=../../impressum/><i class='fa fa-phone fa-fw'></i>Impressum</a></li></ul></div></div><div id=main><div class=header><h1>flexibler Hardware-Tester für x86-Systeme: hwtester</h1><h2></h2></div><div class=content><p>Hier geht es darum, frisch produzierte Geräte der Klassen DLT-V83 und DLT-V72<br>auf Herz und Nieren zu prüfen.<br></p><div class="ox-hugo-toc toc"><div class=heading>Table of Contents</div><ul><li><a href=#projekt-info>Projekt-Info</a></li><li><a href=#anforderungen>Anforderungen</a></li><li><a href=#image-erstellen>Image erstellen</a></li><li><a href=#automatisiert-usb-stick-erstellen>automatisiert USB-Stick erstellen</a></li><li><a href=#tests>Tests</a><ul><li><a href=#testpl%C3%A4tze>Testplätze</a></li><li><a href=#testarten>Testarten</a></li><li><a href=#ger%C3%A4te>Geräte</a></li><li><a href=#aufbau-der-tests>Aufbau der Tests</a></li></ul></li><li><a href=#kommunikation-mit-test-fixture>Kommunikation mit Test-Fixture</a></li><li><a href=#testreport-abspeichern>Testreport abspeichern</a></li><li><a href=#dazugeh%C3%B6rige-projekte>Dazugehörige Projekte</a></li></ul></div><div class=job><p>In Beiträgen der Kategorie <a href=../../categories/job/>Job</a> trage ich Projekte zusammen, die ich im Rahmen<br>meiner beruflichen Karriere federführend durchgeführt habe. Ich gehe dabei mit<br>Absicht nicht allzusehr auf Details an: die Interessen meiner Arbeitgeber sollen<br>ja nicht berührt werden.<br></p></div><h2 id=projekt-info>Projekt-Info</h2><p>Idee: Leiter der Elektronikentwicklung<br></p><p>Umsetzung: ich (Programmierung), allerdings mit viel Input von der Fertigung, Reparatur-Abteilung und Qualitätssicherung &mdash; ein echtes Team-Projekt<br></p><p>Nutzung: 2013 bis heute<br></p><p>Implementierung: Combined-Linux, Bash, Python, C, C++<br></p><p>Effizienzgewinn:<br></p><ul><li>erstmals wurden alle hergestellten Geräte systematisch und reproduzierbar getestet<br></li><li>viele Produktionsfehler wurden frühzeitig herausgefunden, teilweise schon beim<br>Lieferanten der Hauptplatine<br></li><li>für jedes Gerät und Test gab es einen Testreport, da war die<br>Qualitätssicherung sehr erfreut<br></li></ul><h2 id=anforderungen>Anforderungen</h2><ul><li>bootet von einem USB-Stick beliebiger Größe<br></li><li>musst an verschiedenen Testorten verschiedene Tests (automatich) aktivieren bzw. deaktivieren<br></li><li>muss verbaute Hardware weitestgehend erkennen<br></li><li>32bit wg. externer Test-Tools<br></li><li>die kommerzielle Testsoftware &ldquo;Toolstar TestLX&rdquo; musste eingebunden werden<br></li><li><strong>keine</strong> Anbindung an die Auftragsverwaltung (wurde so nicht gewünscht)<br></li></ul><h2 id=image-erstellen>Image erstellen</h2><p>Das Image wird dem Tool<br></p><p><a href=../../de/mkimage/>automatisch Images erstellen</a><br></p><p>erstellt. Statt nur<br>&ldquo;<code>bin/run</code>&rdquo; auszuführen wird gibt man einfach eine Konfurationsdatei an:<br></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>~/d/mkimage$ bin/run -c conf/hwtester.imgconf
</span></span></code></pre></div><h2 id=automatisiert-usb-stick-erstellen>automatisiert USB-Stick erstellen</h2><p>Anschließend hat man das Image im Verzeichnis &ldquo;<code>image.hwtester/</code>&rdquo;. Doch wie bringt man das nun auf einen Stick?<br>Indem wir es eine Image verwandeln:<br></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-1><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-2><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-3><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-4><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-5><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-6><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-7><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-8><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-9><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-10><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-11><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-12><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-13><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-14><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-15><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-16><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=org-coderef--0a417f-17><a style=outline:none;text-decoration:none;color:inherit href=#org-coderef--0a417f-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># make -n hda
</span></span><span style=display:flex><span>rm -f hda
</span></span><span style=display:flex><span>fallocate -l 640M hda
</span></span><span style=display:flex><span>dd bs=440 conv=notrunc count=1 if=/usr/lib/EXTLINUX/gptmbr.bin of=hda.hwtester
</span></span><span style=display:flex><span>sgdisk hda --new 1::600M --typecode=1:8300   # 8300: Linux filesystem
</span></span><span style=display:flex><span>sgdisk hda --change-name=1:&#34;Linux filesystem&#34;
</span></span><span style=display:flex><span>sgdisk hda --partition-guid=1:6f8f4e09-84df-3804-1c41-38f20001b6c8
</span></span><span style=display:flex><span>sgdisk hda --attributes 1:set:2
</span></span><span style=display:flex><span>losetup -D
</span></span><span style=display:flex><span>kpartx -sva hda
</span></span><span style=display:flex><span>losetup /dev/loop1 /dev/mapper/loop0p1
</span></span><span style=display:flex><span>mke2fs -j /dev/loop1
</span></span><span style=display:flex><span>tune2fs -i 0 /dev/loop1
</span></span><span style=display:flex><span>tune2fs -c 0 /dev/loop1
</span></span><span style=display:flex><span>sync
</span></span><span style=display:flex><span>losetup -d /dev/loop1
</span></span><span style=display:flex><span>kpartx -sd hda
</span></span></code></pre></td></tr></table></div></div><ul><li>Zeile <a href=#org-coderef--0a417f-2>2</a>: zuerst löschen wir eine eventualle alte &ldquo;<code>hda</code>&rdquo; Datei<br></li><li>Zeile <a href=#org-coderef--0a417f-3>3</a>: dann wird eine neue angelegt. 640 MB reichen dicke aus. Wir<br>verwenden fallocate, weil es schneller als &ldquo;<code>dd if=/dev/zero ...</code>&rdquo; ist. Es<br>alloziert nur die Blöcke, beschriebt sie aber nicht. Der Linux-Kernel selbst<br>sorgt dafür, das nur 0x00 Bytes enthalten sind.<br></li><li>Zeile <a href=#org-coderef--0a417f-4>4</a>: nun wird aus dem Host-System der EXTLINUX Bootloader an die<br>richtige Position der &ldquo;<code>hda</code>"-Datei kopiert. &ldquo;EXTLINUX&rdquo; ist weniger komplex<br>als Grub und für Industrieanwendungen vorzuziehen.<br></li><li>Zeile <a href=#org-coderef--0a417f-5>5</a>: nun wird mit &ldquo;<code>sgdisk</code>&rdquo; eine GPT-Partition <strong>in der Datei</strong> &ldquo;<code>hda</code>&rdquo;<br>erstellt.<br></li><li>Zeile <a href=#org-coderef--0a417f-9>9</a>: falls man früher noch ein Loopback-Mount hat, wird dies hier<br>zur Sicherheit mit <a href=https://manpages.debian.org/bookworm/mount/losetup.8.en.html>losetup</a> gelöscht<br></li><li>Zeile <a href=#org-coderef--0a417f-10>10</a>: der Befehl <a href=https://manpages.debian.org/bookworm/kpartx/kpartx.8.en.html>kpartx</a> macht nun die normale Datei &ldquo;<code>hda</code>&rdquo; dem<br>Kernel bekannt. Er denkt nun sozusagen, das diese Datei ein Blockdevice ist.<br>Der Kernel ließt die Partition von &ldquo;<code>hda</code>&rdquo; und erstellt<br>für jede Partition ein Loopback-Device in &ldquo;<code>/dev/mapper/</code>&rdquo;.<br></li><li>Zeile <a href=#org-coderef--0a417f-11>11</a>: dieses Partition-Loopback-Device mappen wir nun mit <a href=https://manpages.debian.org/bookworm/mount/losetup.8.en.html>losetup</a>, damit wir<br>darauf zugreifen können: nun ist Filesystem erstellen oder auch Mounten möglich<br></li><li>Zeile <a href=#org-coderef--0a417f-12>12</a>: diese Partition wird nun mit ext4 formatiert. Nicht durch<br>den Namen des Binaries, &ldquo;<code>mke2fs</code>&rdquo; beirren lassen: das &ldquo;<code>-j</code>&rdquo; sorgt dafür, das<br>ein Journalling-Filesystem angelegt wird, und das ist schon seit Jahren per<br>Default ext4.<br></li><li>Zeile <a href=#org-coderef--0a417f-13>13</a>: damit die Mitarbeiter in der Produktion nicht auf irgendwelche<br>fsck&rsquo;s warten müssen, wird das Interval- und Zeitbasierte Prüfen des<br>Filesystems ausgeschaltet. Es ist sowieso nicht möglich, da der Stick sowieso<br>mit einem <a href=../../de/dynamischer-flashschutz/>dynamischen Flash-Schutz </a>vor<br>Schreibzugriffen geschützt ist<br></li><li>am Schluss löschen wir das loopback-Device und sagen dem Kernel, das &ldquo;<code>hda</code>&rdquo;<br>nun nichts besonderes mehr ist &mldr; nur eine Datei<br></li></ul><p>Ein weiteres Makefile-Target &mldr;<br></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># make -n image2hda
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>&mldr; nutzt ebenfalls <a href=https://manpages.debian.org/bookworm/mount/losetup.8.en.html>losetup</a> und <a href=https://manpages.debian.org/bookworm/kpartx/kpartx.8.en.html>kpartx</a>. Aber statt &ldquo;<code>tune2fs</code>&rdquo; wird dann &ldquo;<code>/dev/loop1</code>&rdquo;<br>einfach nach &ldquo;<code>/mnt</code>&rdquo; gemounted und mit &ldquo;<code>rsync</code>&rdquo; wird alles von &ldquo;<code>image.hwtester/</code>&rdquo; dorthin<br>synchronisiert. Da dies aber alles trivial ist, lasses ich es mal aus.<br></p><p>Übrigens: die Datei &ldquo;<code>hda</code>&rdquo; ist sehr klein, sie kann auf 1 GB bis 32 GB Sticks<br>geschrieben werden:<br></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># lsblk
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span># cat hda &gt;/dev/sdc
</span></span></code></pre></div><p>Übrigens: zum Kopieren von Images auf Sticks braucht man kein &ldquo;<code>dd</code>&rdquo; unter<br>Linux. Der ganz normale &ldquo;<code>cat</code>&rdquo; Befehl tut es auch. Und er hat eine durchaus<br>nettere Syntax :-)<br></p><p>Übrigens 2: Beim ersten Booten wird passt der Stick seine eigene Partition<br>dynamisch auf die echte Stickgröße an. USB-Sticks haben ja unterschiedliche<br>echte Größen, bedingt durch Bad-Sector-Management direkt auf dem Stick. Uns<br>stört das aber nicht.<br></p><h2 id=tests>Tests</h2><p>Nun haben wir also einen bootenden USB-Stick. Und dort befinden sich in<br>&ldquo;<code>/usr/local/hwtester</code>&rdquo; alle Test-Scripte, -Binaries etc. Doch bevor wir auf die<br>eigentlichen Tests eingehen, müssen wir erst einige Konzepte einführen.<br></p><h3 id=testplätze>Testplätze</h3><p>Hiermit ist nicht gemeint, ob in der Pruduktion 4 oder 8 Leute Geräte zusammenbauen.<br></p><p>Sondern die verschiedenen Orte, an denen wir Testen möchten:<br></p><ul><li>nach der Produktion der Hauptplatine &mdash; dies sollte schon beim Herstellungsort<br>geschehen, um aufwändige Rückliefergen vorzubeugen. Zu diesem Zeitpunkt gibt es<br>aber keine Front-Platine (Display, Fronttasten, Touch, Defroster). Daher dürfen<br>Tests dafür hier nicht ablaufen<br></li><li>Endgerätefertigung nach Kundenwunsch: hier wird ein Mainboard mit der gewünschten<br>Front zusammengeführt. Je nach Auftrag kann das 10&rdquo;, 12" oder 15" sein. Verschiedene<br>LCD-Aufläsungen. Verschiedene Anzahl von Tasten auf der Front. Da diese Geräte hinterher<br>an den Kunden gehen, gibt es auch Sichtprüfungen (&ldquo;Hat die Lackierung einen Kratzer?&rdquo;)<br></li><li>Service: auch hier sollten Tests ausführbar, aber i.d.R. manuell. Auch dürfen diese Tests<br>keinerlei Änderungen durchführen. Also nicht automatisch &ldquo;Oh, das BIOS ist veraltet,<br>ich flash da mal ein Neues drauf&rdquo;. Der Grund liegt darin, das manche Kunden die Geräte<br>in EXAKT der abgenommenen Konfiguration haben wollen, einschließlich der BIOS-Version<br></li></ul><p>Man kann nun jeden Test einzeln an einen oder mehrere Testorte (auch an alle) binden.<br></p><h3 id=testarten>Testarten</h3><p>Naturgemäß gibt es mehrere Tests<br></p><ul><li>automatische Tests: diese liebt der Leiter der Fertigung. Sie laufen<br>vollautomatisch ab, oft in Sekundenbruchteilen. Sie sind daher (nahezu)<br>kostenneutral. Nahezu, weil man für einige dieser Test vorher die passenden<br>Teststecker einstecken muss. Beispiel: Prüfen der seriellen Schnittstelle.<br>Automatische Tests werden einer nach den anderen ausgeführt.<br></li><li>manuelle Tests: hier geht es um Dinge, die man nicht automatisieren kann &mdash;<br>oder deren Automatisierung zwar an sich möglich ist, sich aber aufgrund der<br>Stückzahlen nicht lohnt. Beispiel: obige &ldquo;Hat das Gehäuse einen Kratzer?&rdquo;<br>Abfrage. Auch manuelle Tests werden einer nach den anderen ausgeführt.<br></li><li>optionale Tests: manchmal ist eine Hardware nur für machen Kunden verbaut,<br>aber nicht generell. Also muss z.B. der CAN-Test nicht immer ausgeführt<br>werden. Diese Tests müssen per Menü per Hand ausgewählt werden.<br></li></ul><p>Man weist nun jeden Test eine Testart zu. Diese kann auch verschieden sein:<br>viele automatische Tests der Produktion sind optionale Tests im Service.<br></p><h3 id=geräte>Geräte</h3><p>Bedingt durch die Hardware-Erkennung des zugrundeliegenden<br>&ldquo;<a href=../../de/combined-linux/> Combined-Linux: ein Image für viele Geräte </a>&rdquo; läuft<br>der Teststick auf viele Gerätetypen und Varianten. Aber ein i2c-Test für den<br>DLT-V83 muss natürlich nach anderen Devices suchen als einer für den DLT-V72.<br></p><p>Man weist nun jeden Test eine oder mehrere Geräte zu.<br></p><p>Auch kann man einen Test an eine USB- oder PCI-ID binden.<br></p><h3 id=aufbau-der-tests>Aufbau der Tests</h3><p>Jeder Test ist ein einzelnes File im &ldquo;<code>tests/</code>&rdquo; Verzeichnis, für sich abgeschlossen. Die<br>Komplexität der Tests ist i.d.R. gering, zwischen 10 und 330 Programmzeilen. Je nach dem,<br>was einfacher war, wurden sie in Bash oder Python geschrieben.<br></p><p>Jeder Test hat speziell formatierte Kommentare, die Testorte, Testarten und Geräte definieren.<br>Hier ein Beispiel für &ldquo;<code>report_cpu_snr.sh</code>&rdquo;:<br></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test: auto everywhere G7I??C??</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>. lib.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>head <span style=color:#e6db74>&#34;CPU board serial number&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./amidelnx_26_32 /BS | grep Done <span style=color:#f92672>||</span> error <span style=color:#e6db74>&#34;cannot get SNR&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok <span style=color:#e6db74>&#34;done&#34;</span>
</span></span></code></pre></div><p>Das ist ein automatischer Test, der an jedem Testort ausgeführt werden soll,<br>jedoch nur für die Geräteklasse G7I??C??.<br></p><p>Derselbe &ldquo;<code>^# Test:</code>"-Marker würde auch in einem Python-Test verwendet werden.<br>Dort werden meist komplexere Dinge getestet, welche in Bash nicht so einfach zu<br>lösen sind. Hier ein Beispiel:<br></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/python2.7</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test: auto everywhere M7I??A??</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Test: auto everywhere G7I?????</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> lib <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> glob <span style=color:#f92672>import</span> glob
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>head(<span style=color:#e6db74>&#34;CPU temperature in range?&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WANTSMIN <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>WANTSMAX <span style=color:#f92672>=</span> <span style=color:#ae81ff>65</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>acpitz</span>():
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>coretemp</span>():
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> hwmatch(<span style=color:#e6db74>&#34;M7I??A??&#34;</span>):
</span></span><span style=display:flex><span>	value <span style=color:#f92672>=</span> acpitc()
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>	value <span style=color:#f92672>=</span> coretemp()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> value <span style=color:#f92672>&lt;</span> WANTSMIN:
</span></span><span style=display:flex><span>        error(<span style=color:#e6db74>&#34;CPU temperature too low: </span><span style=color:#e6db74>%.1f</span><span style=color:#e6db74> °C&#34;</span> <span style=color:#f92672>%</span> value)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> value <span style=color:#f92672>&gt;</span> WANTSMAX:
</span></span><span style=display:flex><span>        error(<span style=color:#e6db74>&#34;CPU temperature too high: </span><span style=color:#e6db74>%.1f</span><span style=color:#e6db74> °C&#34;</span> <span style=color:#f92672>%</span> value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok(<span style=color:#e6db74>&#34;CPU temperature between </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> and </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>: </span><span style=color:#e6db74>%.1f</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (WANTSMIN, WANTSMAX, value))
</span></span></code></pre></div><p>Jaaaa, hier wird noch Python 2.7 verwendet. Bei Projektstart war Python 3 noch<br>nicht soweit.<br></p><h2 id=kommunikation-mit-test-fixture>Kommunikation mit Test-Fixture</h2><p>Am Produktionsplatz der Hauptplatine für den DLT-V83 gab es auch ein<br>Test-Fixture. Dieses hat mit dem Teststick über ein serielles Kabel<br>kommunuziert. Die Testsoftware dort hat dann bei mir z.B. &ldquo;Mach mal ordentlich<br>CPU-Last&rdquo; angefordert und dann z.B. den aufgenommenen Strom gemessen, während<br>mein Testprogramm die Coretemp währenddessen gemessen hat.<br></p><h2 id=testreport-abspeichern>Testreport abspeichern</h2><p>Nachdem alle Tests durchgeführt gab, hat der Produktionsmitarbeiter &ldquo;Finalize<br>Tests&rdquo; ausgeführt. Damit wurde dann ein Testprotokoll per SMB oder FTP auf einem<br>Server im Produktionsnetz (vom Firmennetz getrennt!) gespeichert.<br></p><p>Dort waren natürlich alle Testergebisse, aber man konnte auch nachvollziehen<br>oder ein optionaler Test ausgeführt worden ist &mldr; oder nicht.<br></p><p>Neben reinen Testergebnissen wurden dort auch viele Informationen abgespeichert,<br>beispielsweise die MAC-Adresse der Ethernet- und WIFI-Ports &mdash; so haben wir<br>z.B. bemerkt, das wir einmal viele Mainboards mit identischen MAC-Adressen<br>geliefert bekamen.<br></p><h2 id=dazugehörige-projekte>Dazugehörige Projekte</h2><p>Die folgenden Projekte sind mit dem &ldquo;<code>hwtester</code>&rdquo; verwandt, weil er entweder<br>darauf aufbaut, es nutzt oder das Projekt extrem ähnlich ist.<br></p><ul><li><a href=../../de/combined-linux/>Combined-Linux: ein Image für viele Geräte</a><br></li><li><a href=../../de/mkimage/>automatisch Images erstellen</a><br></li><li><a href=../../de/dynamischer-flashschutz/>Dynamischer Flash-Schutz</a><br></li><li>TODO(Artikel schreiben) Hardware-Teststick für DLT-V73<br></li></ul><p>Die Projekte, die mit diesem Tool erstellte Images verwenden zähle ich jetzt mal<br>nicht auf :-)</p><div class=post-meta><div><i class="fa fa-copyright fa-fw"></i>
License: <a href=https://spdx.org/licenses/CC-BY-SA-4.0.html target=_blank>CC-BY-SA 4.0</a></div><div><i class="fa fa-calendar fa-fw"></i>
<time>2024-01-18</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=../../categories/job>job</a>
<a class=rss type=application/rss+xml href=../../categories/job/index.xml><span class="fa fa-rss">RSS</span></a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=../../tags/linux>linux</a>
<a class=rss type=application/rss+xml href=../../tags/linux/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/kernel>kernel</a>
<a class=rss type=application/rss+xml href=../../tags/kernel/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/systemd>systemd</a>
<a class=rss type=application/rss+xml href=../../tags/systemd/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/make>make</a>
<a class=rss type=application/rss+xml href=../../tags/make/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/debian>debian</a>
<a class=rss type=application/rss+xml href=../../tags/debian/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/dpkg>dpkg</a>
<a class=rss type=application/rss+xml href=../../tags/dpkg/index.xml><span class="fa fa-rss">RSS</span></a>
&nbsp;/
<a class=post-taxonomy-tag href=../../tags/eatmydata>eatmydata</a>
<a class=rss type=application/rss+xml href=../../tags/eatmydata/index.xml><span class="fa fa-rss">RSS</span></a></div></div></div></div></div><script src=../../js/ui.js></script><script src=../../js/menus.js></script><script src=../../js/math-code.js></script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>