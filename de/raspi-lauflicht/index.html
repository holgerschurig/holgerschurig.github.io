<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.82.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta property="og:title" content="Lauflicht mit Raspberry und 74HC595"><meta name=keywords content="RasPi,74HC595,GPIO,SPI"><meta property="og:title" content="Lauflicht mit Raspberry und 74HC595"><meta property="og:description" content="Bei dieser Schaltung geht es mir weniger darum, 8 LEDs zu betreiben.
Die kann man nämlich auch direkt am Raspberry Pi anschließen. Sondern
es geht darum, mit den Schieberegister 74HC595 zu experimentieren.
Dieses steuere ich zunächst durch diverse GPIO Ports an.
Und danach betreibe ich es am SPI-Port des RasPi. Das funktioniert
wunderbar, obwohl der Text &ldquo;SPI&rdquo; nirgendwo im 74HC595-Datenblatt
auftaucht :-)"><meta property="og:type" content="article"><meta property="og:url" content="http://holgerschurig.github.io/de/raspi-lauflicht/"><meta property="article:section" content="de"><meta property="article:published_time" content="2016-03-06T12:32:10+01:00"><meta property="article:modified_time" content="2016-03-06T12:32:10+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lauflicht mit Raspberry und 74HC595"><meta name=twitter:description content="Bei dieser Schaltung geht es mir weniger darum, 8 LEDs zu betreiben.
Die kann man nämlich auch direkt am Raspberry Pi anschließen. Sondern
es geht darum, mit den Schieberegister 74HC595 zu experimentieren.
Dieses steuere ich zunächst durch diverse GPIO Ports an.
Und danach betreibe ich es am SPI-Port des RasPi. Das funktioniert
wunderbar, obwohl der Text &ldquo;SPI&rdquo; nirgendwo im 74HC595-Datenblatt
auftaucht :-)"><link rel=icon type=image/png href=../../favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=../../css/normalize.css><link rel=stylesheet type=text/css media=screen href=../../css/main.css><link rel=stylesheet type=text/css media=screen href=../../css/all.css><link rel=stylesheet href=../../css/katex.min.css crossorigin=anonymous><script defer src=../../js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=../../js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><title>Lauflicht mit Raspberry und 74HC595 | Holger Schurig's Computer Calisthenics & Orthodontia</title></head><body><header><div id=avatar><a href=http://holgerschurig.github.io/><img src=../../img/vitae.jpg alt="Holger Schurig's Computer Calisthenics & Orthodontia"></a></div><div id=titletext><h2 id=title><a href=http://holgerschurig.github.io/>Holger Schurig's Computer Calisthenics & Orthodontia</a></h2></div><div id=title-description><p id=subtitle></p><div id=social><nav><ul><li><a href=../../index.xml><i title=RSS class="icons fas fa-rss"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=../../en>English</a></li><li><a href=../../de>Deutsch</a></li><li><a href=../../tags>Tags</a></li><li><a href=../../topics>Topics</a></li><li><a href=../../impressum>Impressum</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>06</span>
<span class=rest>Mar 2016</span></div></div><div class=matter><h1 class=title>Lauflicht mit Raspberry und 74HC595</h1></div></div><div class=markdown><p>Bei dieser Schaltung geht es mir weniger darum, 8 LEDs zu betreiben.
Die kann man nämlich auch direkt am Raspberry Pi anschließen. Sondern
es geht darum, mit den Schieberegister 74HC595 zu experimentieren.</p><p>Dieses steuere ich zunächst durch diverse GPIO Ports an.</p><p>Und danach betreibe ich es am SPI-Port des RasPi. Das funktioniert
wunderbar, obwohl der Text &ldquo;SPI&rdquo; nirgendwo im 74HC595-Datenblatt
auftaucht :-)</p><h2 id=schaltung>Schaltung</h2><p>Die Schaltung ist einfach:</p><ul><li>der 74HC595 bekommt <code>VCC</code> und <code>GND</code>. Da es ein HC-Chip ist, kann er
anders als normale TTL-Bausteine direkt mit 3.3V betrieben
werden. Das ist wichtig, da der Raspberry Pi <strong>nicht</strong> 5V-tolerant
ist.</li><li><code>nOE</code> (negative Output Enable) geht an <code>GND</code>. Der &lsquo;595 halt also
immer ein Output Enable.</li><li><code>nMR</code> (Master Reclear) geht and <code>VCC</code>. Damit wird also der &lsquo;595 nie
zurückgesetzt.</li><li><code>SH_CP</code> (Shift Register Clock Pin) geht an das Signal <code>SPI0_SCLK</code>, also die
Clock des SPI0.</li><li><code>ST_CP</code> (Storage Register Clock Pin) geht <code>SPI0_CE0</code>, also an das Chip Enable 0
Signal des SPI0 Busses.</li><li><code>DS</code> (Data Serial Input) geht an das Signal <code>SPI0_MOSI</code>, also den seriellen
Ausgang von SPI0.</li></ul><p>Das war schon das ganze Interface zwischen &lsquo;595 und Raspberry.</p><p>Nach &ldquo;oben&rdquo; zu den LEDs haben wir 8 Ausgabe, <code>Q0</code> bis <code>Q7</code>. Der
Einfachheit halber habe ich nur zwei LEDs eingezeichnet.</p><p>Auch war ich sparsam: ich habe einfach nur einen passenden,
gemeinsamen Vorwiderstand von 220 Ohm eingebaut. Damit sind die LEDs
unterschiedlich hell wenn man mal mehr als eine LED anschaltet. Da es
mir aber darum ging, den &lsquo;595 und SPI zu verstehen, war mir das egal.
Ansonsten hätte ich eine Konstantstromquelle vorgesehen.</p><h2 id=verdrahtung>Verdrahtung</h2><p>Auch in die Verdrahtung habe ich nur 2 von 8 LEDs eingetragen.</p><h2 id=software-für-gpio>Software für GPIO</h2><p>Zunächst habe ich das ganze via GPIO, also per &ldquo;Big Banging&rdquo; betrieben. Das geht so:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888>#!/usr/bin/python</span>

<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>sys</span><span style=color:#333>,</span> <span style=color:#0e84b5;font-weight:700>time</span>

SPEED <span style=color:#333>=</span> <span style=color:#60e;font-weight:700>0.04</span>

<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>RPi.GPIO</span> <span style=color:#080;font-weight:700>as</span> <span style=color:#0e84b5;font-weight:700>GPIO</span>
GPIO<span style=color:#333>.</span>setmode(GPIO<span style=color:#333>.</span>BCM)
GPIO<span style=color:#333>.</span>setwarnings(False)


<span style=color:#888># Nebeneinander liegende GPIOs:</span>
<span style=color:#888># DATA   = 22 # DS</span>
<span style=color:#888># LATCH  = 27 # STCP</span>
<span style=color:#888># CLOCK  = 17 # SHCP</span>

<span style=color:#888># Die Pins von SPI0 nutzend, aber noch als GPIO benutzt:</span>
DATA    <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>10</span> <span style=color:#888># SPI0_MOSI</span>
LATCH   <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>8</span>  <span style=color:#888># SPI0 CS0</span>
CLOCK   <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>11</span> <span style=color:#888># SPI0 CLK</span>

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>setup</span>():
	GPIO<span style=color:#333>.</span>setmode(GPIO<span style=color:#333>.</span>BCM)
	GPIO<span style=color:#333>.</span>cleanup()
	GPIO<span style=color:#333>.</span>setup(DATA,  GPIO<span style=color:#333>.</span>OUT)
	GPIO<span style=color:#333>.</span>setup(CLOCK, GPIO<span style=color:#333>.</span>OUT)
	GPIO<span style=color:#333>.</span>setup(LATCH, GPIO<span style=color:#333>.</span>OUT)
	GPIO<span style=color:#333>.</span>output(DATA,  False)  <span style=color:#888># Databit to be shifted into the register</span>
	GPIO<span style=color:#333>.</span>output(LATCH, False)  <span style=color:#888># Latch is used to output the saved data</span>
	GPIO<span style=color:#333>.</span>output(CLOCK, False)  <span style=color:#888># Used to shift the value of DATAIN to the register</span>

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>shift</span>(dat):
	GPIO<span style=color:#333>.</span>output(DATA,  dat)
	GPIO<span style=color:#333>.</span>output(CLOCK, GPIO<span style=color:#333>.</span>HIGH)
	GPIO<span style=color:#333>.</span>output(CLOCK, GPIO<span style=color:#333>.</span>LOW)

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>writeout</span>():
	GPIO<span style=color:#333>.</span>output(LATCH, GPIO<span style=color:#333>.</span>HIGH)
	<span style=color:#888># time.sleep(icsleep)</span>
	GPIO<span style=color:#333>.</span>output(LATCH, GPIO<span style=color:#333>.</span>LOW)

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>shiftnum</span>(dat):
	<span style=color:#080;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>8</span>):
		shift(dat <span style=color:#333>&amp;</span> <span style=color:#058;font-weight:700>0x80</span> <span style=color:#333>!=</span> <span style=color:#00d;font-weight:700>0</span>)
		dat <span style=color:#333>&lt;&lt;=</span> <span style=color:#00d;font-weight:700>1</span>
	writeout()

setup()

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>run_down</span>():
	n <span style=color:#333>=</span> <span style=color:#058;font-weight:700>0x01</span>
	<span style=color:#080;font-weight:700>while</span> n <span style=color:#333>&lt;</span> <span style=color:#058;font-weight:700>0x100</span>:
		shiftnum(n)
		time<span style=color:#333>.</span>sleep(SPEED)
		n <span style=color:#333>&lt;&lt;=</span> <span style=color:#00d;font-weight:700>1</span>

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>run_up</span>():
	n <span style=color:#333>=</span> <span style=color:#058;font-weight:700>0x80</span>
	<span style=color:#080;font-weight:700>while</span> n:
		shiftnum(n)
		time<span style=color:#333>.</span>sleep(SPEED)
		n <span style=color:#333>&gt;&gt;=</span> <span style=color:#00d;font-weight:700>1</span>

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>run_pattern</span>(pattern, speed<span style=color:#333>=</span><span style=color:#60e;font-weight:700>0.08</span>):
	<span style=color:#080;font-weight:700>for</span> n <span style=color:#000;font-weight:700>in</span> pattern:
		shiftnum(n)
		time<span style=color:#333>.</span>sleep(speed)

<span style=color:#080;font-weight:700>try</span>:
	<span style=color:#080;font-weight:700>while</span> True:
		run_down()
		run_up()
		<span style=color:#888># run_pattern((</span>
		<span style=color:#888># 	0x80 | 0x04,</span>
		<span style=color:#888># 	0x40 | 0x08,</span>
		<span style=color:#888># 	0x20 | 0x10,</span>
		<span style=color:#888># 	0x10 | 0x20,</span>
		<span style=color:#888># 	0x08 | 0x40,</span>
		<span style=color:#888># 	0x04 | 0x80,</span>
		<span style=color:#888># 	0x02 | 0x01,</span>
		<span style=color:#888># 	0x01 | 0x02))</span>

<span style=color:#080;font-weight:700>except</span> <span style=color:red;font-weight:700>KeyboardInterrupt</span>:
	<span style=color:#080;font-weight:700>print</span>

</code></pre></div><h2 id=software-für-spi>Software für SPI</h2><p>Aber am meisten hatte ich mich für SPI interessiert. Dieses Programm
erbrachte dann das gewünschte Ergebnis:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888>#!/usr/bin/python</span>

<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>sys</span><span style=color:#333>,</span> <span style=color:#0e84b5;font-weight:700>time</span>
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>spidev</span>

spi <span style=color:#333>=</span> spidev<span style=color:#333>.</span>SpiDev()
spi<span style=color:#333>.</span>open(<span style=color:#00d;font-weight:700>0</span>, <span style=color:#00d;font-weight:700>0</span>)    <span style=color:#888># Port 0, Chip Select 0</span>

n <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>1</span>
<span style=color:#080;font-weight:700>while</span> True:
	spi<span style=color:#333>.</span>writebytes([n])
	time<span style=color:#333>.</span>sleep(<span style=color:#60e;font-weight:700>0.04</span>)
	n <span style=color:#333>&lt;&lt;=</span> <span style=color:#00d;font-weight:700>1</span>
	<span style=color:#080;font-weight:700>if</span> n <span style=color:#333>==</span> <span style=color:#058;font-weight:700>0x100</span>:
	    n <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>1</span>

</code></pre></div><p>Funktionen wie <code>run_down</code>, <code>run_up</code> habe ich mir hier gespart, sie
funktionieren im Prinzip genauso wie beim GPIO-Beispiel.</p><p>Und, wie man sieht: die eigentliche Ausgabe in das Schieberegister ist
wesentlich einfacher.</p></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=../../tags/74hc595/>74hc595</a>
<a href=../../tags/gpio/>gpio</a>
<a href=../../tags/raspi/>raspi</a>
<a href=../../tags/spi/>spi</a></p></div><div class=clearit></div><div class=tags><div class=taxosfloating_left><p>Topics</p></div><div class=termsfloating_right><p><a href=../../topics/elektronik/>elektronik</a></p></div><div class=clearit></div></div></div></main></body></html>